---
phase: 10-git-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/main.js
  - src/main/preload.js
autonomous: true

must_haves:
  truths:
    - "Git status is retrievable via IPC from renderer"
    - "Git branch name is retrievable via IPC from renderer"
    - "Recent commits are retrievable via IPC from renderer"
  artifacts:
    - path: "src/main/main.js"
      provides: "Git IPC handlers"
      contains: "get-git-status"
    - path: "src/main/preload.js"
      provides: "Git API exposure to renderer"
      contains: "getGitStatus"
  key_links:
    - from: "src/main/preload.js"
      to: "src/main/main.js"
      via: "ipcRenderer.invoke"
      pattern: "invoke.*get-git"
---

<objective>
Implement Git backend operations and expose them to the renderer process via IPC.

Purpose: This is the foundation for all git integration features. The renderer needs access to git status, branch, and commit data.
Output: IPC handlers in main.js and API exposure in preload.js that allow renderer to query git information.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/main/main.js
@src/main/preload.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Git IPC handlers to main.js</name>
  <files>src/main/main.js</files>
  <action>
Add git operations using Node.js child_process (NOT simple-git - avoid adding dependencies).

Add these IPC handlers after the existing handlers in main.js:

1. `get-git-status` handler:
   - Takes projectPath as parameter
   - Runs `git status --porcelain` in the project directory
   - Parses output to extract:
     - Modified files (unstaged): lines starting with ` M` or `?M`
     - Staged files: lines starting with `M `, `A `, `D ` (staged modifications, additions, deletions)
     - Untracked files: lines starting with `??`
   - Returns: `{ modified: string[], staged: string[], untracked: string[], error?: string }`
   - Handle non-git directories gracefully (return empty arrays, no error)

2. `get-git-branch` handler:
   - Takes projectPath as parameter
   - Runs `git branch --show-current` in the project directory
   - Returns: `{ branch: string, error?: string }`
   - For detached HEAD, run `git rev-parse --short HEAD` as fallback

3. `get-git-commits` handler:
   - Takes projectPath and limit (default 10) as parameters
   - Runs `git log --oneline -n {limit}` in the project directory
   - Parses output to extract: `{ hash: string, message: string }[]`
   - Returns: `{ commits: Array<{hash: string, message: string}>, error?: string }`

Implementation pattern:
```javascript
const { execSync } = require('child_process');

function runGitCommand(command, cwd) {
  try {
    return execSync(command, { cwd, encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }).trim();
  } catch (err) {
    return null;
  }
}
```

Use this helper in each handler. Wrap in try/catch and return error field if git fails.
  </action>
  <verify>
Run `npm start`, open DevTools console, and verify:
- `await window.electronAPI.getGitStatus(projectPath)` returns object with modified/staged/untracked arrays
- `await window.electronAPI.getGitBranch(projectPath)` returns object with branch string
- `await window.electronAPI.getGitCommits(projectPath)` returns object with commits array
  </verify>
  <done>
All three git IPC handlers return valid data from a git repository, and return empty/null gracefully for non-git directories.
  </done>
</task>

<task type="auto">
  <name>Task 2: Expose Git APIs in preload.js</name>
  <files>src/main/preload.js</files>
  <action>
Add git API methods to the electronAPI object exposed via contextBridge:

```javascript
// Add these to the contextBridge.exposeInMainWorld call:
getGitStatus: (projectPath) => ipcRenderer.invoke('get-git-status', projectPath),
getGitBranch: (projectPath) => ipcRenderer.invoke('get-git-branch', projectPath),
getGitCommits: (projectPath, limit) => ipcRenderer.invoke('get-git-commits', projectPath, limit),
```

Place after the existing `addRecentProject` line, maintaining the existing code structure.
  </action>
  <verify>
After adding, verify preload.js has no syntax errors:
`node -c src/main/preload.js` should return no output (success).
Then run `npm start` and verify `window.electronAPI.getGitStatus` exists in DevTools console.
  </verify>
  <done>
The electronAPI object in renderer has getGitStatus, getGitBranch, and getGitCommits methods available.
  </done>
</task>

</tasks>

<verification>
1. Run `npm start`
2. Select a git repository as project
3. In DevTools console:
   - `await window.electronAPI.getGitStatus('/path/to/project')` returns status object
   - `await window.electronAPI.getGitBranch('/path/to/project')` returns branch name
   - `await window.electronAPI.getGitCommits('/path/to/project', 5)` returns recent commits
4. Test with a non-git directory - should return empty results without crashing
</verification>

<success_criteria>
- Git status, branch, and commits are accessible from renderer via electronAPI
- Non-git directories handled gracefully
- App starts without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-git-integration/10-01-SUMMARY.md`
</output>
