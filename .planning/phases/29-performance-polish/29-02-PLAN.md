---
phase: 29-performance-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/renderer.js
  - src/renderer/index.html
  - src/main/main.js
autonomous: true

must_haves:
  truths:
    - "User receives notification if Claude hooks are not configured"
    - "Debug mode shows Claude operation traffic for troubleshooting"
    - "Notification is non-intrusive and dismissible"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Hook status detection and debug toggle"
      contains: "hookStatusTimeout"
    - path: "src/renderer/index.html"
      provides: "Hook status notification UI"
      contains: "hook-status-notification"
  key_links:
    - from: "onClaudeOperation listener"
      to: "hookStatusTimeout clearance"
      via: "first event received"
      pattern: "clearTimeout.*hookStatusTimeout"
---

<objective>
Add hook configuration detection with user notification and debug mode for Claude operation traffic

Purpose: Users need to know if Claude hooks aren't working (no event files being generated). Additionally, a debug mode helps troubleshoot when events aren't triggering expected animations.

Output: Notification banner when no Claude events received after timeout, debug toggle showing operation traffic
</objective>

<execution_context>
@/home/rafreid/.claude/get-shit-done/workflows/execute-plan.md
@/home/rafreid/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-enhanced-flash-effects/28-01-SUMMARY.md
@src/renderer/renderer.js
@src/renderer/index.html
@src/main/main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hook status detection with notification</name>
  <files>src/renderer/renderer.js, src/renderer/index.html</files>
  <action>
Add hook configuration detection that notifies user if no Claude events received:

1. In index.html, add notification banner HTML (before closing body tag):
   ```html
   <!-- Hook status notification -->
   <div id="hook-status-notification" class="notification-banner hidden">
     <span class="notification-icon">⚠️</span>
     <span class="notification-text">Claude Code hooks not detected. Operations won't trigger flash animations.</span>
     <button class="notification-dismiss" onclick="dismissHookNotification()">×</button>
     <button class="notification-help" onclick="showHookHelp()">Setup Guide</button>
   </div>
   ```

2. Add CSS for notification banner (in style section):
   ```css
   .notification-banner {
     position: fixed;
     top: 10px;
     left: 50%;
     transform: translateX(-50%);
     background: #2c2c2c;
     border: 1px solid #FFA500;
     border-radius: 8px;
     padding: 12px 16px;
     display: flex;
     align-items: center;
     gap: 12px;
     z-index: 1000;
     box-shadow: 0 4px 12px rgba(0,0,0,0.3);
   }
   .notification-banner.hidden { display: none; }
   .notification-icon { font-size: 20px; }
   .notification-text { color: #fff; font-size: 13px; }
   .notification-dismiss {
     background: none;
     border: none;
     color: #888;
     font-size: 20px;
     cursor: pointer;
     padding: 0 4px;
   }
   .notification-dismiss:hover { color: #fff; }
   .notification-help {
     background: #FFA500;
     border: none;
     color: #000;
     padding: 6px 12px;
     border-radius: 4px;
     cursor: pointer;
     font-size: 12px;
   }
   .notification-help:hover { background: #FFB833; }
   ```

3. In renderer.js, add hook status tracking variables (near top with other state):
   ```javascript
   // Hook status detection
   let hookStatusTimeout = null;
   let hookNotificationDismissed = false;
   const HOOK_DETECTION_DELAY = 30000; // 30 seconds
   ```

4. Add detection start function (call from init/app start):
   ```javascript
   function startHookStatusDetection() {
     hookStatusTimeout = setTimeout(() => {
       if (!hookNotificationDismissed) {
         document.getElementById('hook-status-notification')?.classList.remove('hidden');
         console.log('[HookStatus] No Claude events received in 30s, showing notification');
       }
     }, HOOK_DETECTION_DELAY);
   }
   ```

5. In onClaudeOperation listener, clear the timeout on first event:
   ```javascript
   // At start of listener, before processing event:
   if (hookStatusTimeout) {
     clearTimeout(hookStatusTimeout);
     hookStatusTimeout = null;
     console.log('[HookStatus] Claude events detected, hooks working');
   }
   ```

6. Add dismiss and help functions:
   ```javascript
   function dismissHookNotification() {
     document.getElementById('hook-status-notification')?.classList.add('hidden');
     hookNotificationDismissed = true;
   }

   function showHookHelp() {
     // Open setup guide in default browser
     window.electronAPI.openExternal('https://github.com/anthropics/claude-code/blob/main/HOOKS.md');
     dismissHookNotification();
   }
   ```

7. Expose functions globally for onclick handlers:
   ```javascript
   window.dismissHookNotification = dismissHookNotification;
   window.showHookHelp = showHookHelp;
   ```

8. Call startHookStatusDetection() in the init section (after graph is loaded)
  </action>
  <verify>
1. Read index.html and confirm notification banner HTML exists
2. Read renderer.js and confirm hookStatusTimeout variable exists
3. Confirm startHookStatusDetection function exists
4. Confirm clearTimeout in onClaudeOperation listener
5. Confirm dismiss and help functions exist and are exposed globally
  </verify>
  <done>
Notification banner appears after 30 seconds if no Claude events received. First event clears the timeout. User can dismiss or open setup guide.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add debug mode toggle for Claude operation traffic</name>
  <files>src/renderer/renderer.js, src/renderer/index.html</files>
  <action>
Add debug panel that shows Claude operation traffic when enabled:

1. In index.html, add debug panel HTML (in controls section, after existing controls):
   ```html
   <!-- Debug panel toggle -->
   <div class="control-group">
     <label class="toggle-label">
       <input type="checkbox" id="debug-toggle">
       <span>Debug Mode</span>
     </label>
   </div>

   <!-- Debug output panel -->
   <div id="debug-panel" class="debug-panel hidden">
     <div class="debug-header">
       <span>Claude Operations</span>
       <button id="debug-clear" class="debug-clear">Clear</button>
     </div>
     <div id="debug-content" class="debug-content"></div>
   </div>
   ```

2. Add CSS for debug panel:
   ```css
   .debug-panel {
     position: fixed;
     bottom: 10px;
     right: 10px;
     width: 400px;
     max-height: 300px;
     background: rgba(0,0,0,0.9);
     border: 1px solid #4ECDC4;
     border-radius: 8px;
     z-index: 200;
     font-family: monospace;
     font-size: 11px;
   }
   .debug-panel.hidden { display: none; }
   .debug-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     padding: 8px 12px;
     border-bottom: 1px solid #333;
     color: #4ECDC4;
   }
   .debug-clear {
     background: #333;
     border: none;
     color: #888;
     padding: 4px 8px;
     border-radius: 4px;
     cursor: pointer;
     font-size: 10px;
   }
   .debug-clear:hover { background: #444; color: #fff; }
   .debug-content {
     max-height: 250px;
     overflow-y: auto;
     padding: 8px;
   }
   .debug-entry {
     padding: 4px 0;
     border-bottom: 1px solid #222;
     color: #ccc;
   }
   .debug-entry:last-child { border-bottom: none; }
   .debug-op { font-weight: bold; }
   .debug-op.read { color: #4488FF; }
   .debug-op.write, .debug-op.edit { color: #FFAA00; }
   .debug-op.create { color: #00FF88; }
   .debug-op.delete { color: #FF3333; }
   .debug-time { color: #666; }
   .debug-path { color: #888; }
   ```

3. In renderer.js, add debug state variable:
   ```javascript
   let debugModeEnabled = false;
   const MAX_DEBUG_ENTRIES = 50;
   ```

4. Add debug toggle handler:
   ```javascript
   document.getElementById('debug-toggle')?.addEventListener('change', (e) => {
     debugModeEnabled = e.target.checked;
     document.getElementById('debug-panel')?.classList.toggle('hidden', !debugModeEnabled);
     console.log('[Debug] Mode', debugModeEnabled ? 'enabled' : 'disabled');
   });

   document.getElementById('debug-clear')?.addEventListener('click', () => {
     const content = document.getElementById('debug-content');
     if (content) content.innerHTML = '';
   });
   ```

5. Add function to log to debug panel:
   ```javascript
   function logDebugOperation(event) {
     if (!debugModeEnabled) return;

     const content = document.getElementById('debug-content');
     if (!content) return;

     const entry = document.createElement('div');
     entry.className = 'debug-entry';

     const time = new Date(event.timestamp).toLocaleTimeString();
     const op = event.operation;
     const path = event.file_path.split('/').pop(); // Just filename

     entry.innerHTML = `
       <span class="debug-time">${time}</span>
       <span class="debug-op ${op}">${op.toUpperCase()}</span>
       <span class="debug-path">${path}</span>
       ${event.nodeId ? '' : '<span style="color:#FF6B6B">(no node)</span>'}
     `;

     content.insertBefore(entry, content.firstChild);

     // Limit entries
     while (content.children.length > MAX_DEBUG_ENTRIES) {
       content.removeChild(content.lastChild);
     }
   }
   ```

6. Call logDebugOperation in onClaudeOperation listener (after the console.log line):
   ```javascript
   logDebugOperation(event);
   ```
  </action>
  <verify>
1. Read index.html and confirm debug panel HTML exists with toggle and content area
2. Read renderer.js and confirm debugModeEnabled variable exists
3. Confirm debug toggle change handler exists
4. Confirm logDebugOperation function exists
5. Confirm logDebugOperation is called in onClaudeOperation listener
  </verify>
  <done>
Debug toggle in controls enables debug panel. Panel shows Claude operation traffic with color-coded operation types, timestamps, and file paths. Clear button empties the log.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add IPC handler for opening external URLs</name>
  <files>src/main/main.js, src/main/preload.js, src/renderer/renderer.js</files>
  <action>
Add IPC handler to open external URLs (for the Setup Guide button):

1. In main.js, add IPC handler (near other ipcMain.handle calls):
   ```javascript
   ipcMain.handle('open-external', async (event, url) => {
     const { shell } = require('electron');
     await shell.openExternal(url);
   });
   ```

2. In preload.js, expose to renderer (in contextBridge.exposeInMainWorld):
   ```javascript
   openExternal: (url) => ipcRenderer.invoke('open-external', url)
   ```

3. In renderer.js, update showHookHelp to use the API:
   ```javascript
   function showHookHelp() {
     // Open setup guide in default browser
     window.electronAPI.openExternal('https://github.com/anthropics/claude-code/blob/main/HOOKS.md');
     dismissHookNotification();
   }
   ```

Note: If shell is already required at top of main.js, just use it directly. If not, require it in the handler.
  </action>
  <verify>
1. Read main.js and confirm 'open-external' IPC handler exists
2. Read preload.js and confirm openExternal is exposed in electronAPI
3. Read renderer.js and confirm showHookHelp uses window.electronAPI.openExternal
  </verify>
  <done>
Clicking "Setup Guide" button opens Claude Code hooks documentation in user's default browser.
  </done>
</task>

</tasks>

<verification>
1. Start GSD Viewer WITHOUT Claude hooks configured
2. Wait 30 seconds - notification banner should appear
3. Click dismiss - banner should hide
4. Restart app with hooks configured
5. Trigger a Claude operation - no notification should appear
6. Enable Debug Mode toggle
7. Trigger Claude operations - debug panel should show traffic
8. Click Clear - debug panel should empty
9. Click Setup Guide (if notification shown) - should open browser to hooks docs
</verification>

<success_criteria>
- [ ] Notification appears after 30s if no Claude events
- [ ] First Claude event clears the timeout (no notification)
- [ ] Notification is dismissible
- [ ] Setup Guide button opens external URL
- [ ] Debug toggle enables/disables debug panel
- [ ] Debug panel shows Claude operation traffic with color coding
- [ ] Debug panel has clear button and entry limit
- [ ] Phase 29 success criteria 3 and 4 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/29-performance-polish/29-02-SUMMARY.md`
</output>
