---
phase: 04-state-visualization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "Completed nodes appear green"
    - "In-progress nodes appear yellow"
    - "Pending nodes appear gray"
    - "Status coloring applies to phases, plans, and requirements"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Status-based color function and integration"
      contains: "getNodeColorByStatus"
  key_links:
    - from: "src/renderer/renderer.js"
      to: "Graph.nodeColor"
      via: "nodeColor callback uses status"
      pattern: "nodeColor.*status"
---

<objective>
Add progress-based coloring to nodes: completed (green), in-progress (yellow), pending (gray).

Purpose: STA-02 requires nodes be colored by their progress status, not just by type. Users should see at a glance which parts of their project are done, in progress, or pending.

Output: Updated renderer.js that colors nodes based on their status property, with type-based coloring as fallback for nodes without status.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/renderer/renderer.js
@src/main/parsers/roadmap-parser.js (shows status values: complete, in-progress, pending)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add status color palette and color function</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update `src/renderer/renderer.js` to add status-based coloring.

1. Add status color palette AFTER the existing nodeColors object:
```javascript
// Status colors for progress visualization (STA-02)
const statusColors = {
  complete: '#4CAF50',      // Green - done
  'in-progress': '#FFC107', // Yellow/amber - working on it
  pending: '#9E9E9E'        // Gray - not started
};
```

2. Add function to determine node color based on status OR type:
```javascript
/**
 * Get node color - prioritizes status for applicable nodes, falls back to type
 * @param {Object} node - Node object with type and optional status
 * @returns {string} Hex color code
 */
function getNodeColor(node) {
  // Nodes that can have status: phases, plans, requirements
  const statusAwareTypes = ['phase', 'plan', 'requirement'];

  // If node has status and is a status-aware type, use status color
  if (node.status && statusAwareTypes.includes(node.type)) {
    return statusColors[node.status] || nodeColors[node.type] || DEFAULT_NODE_COLOR;
  }

  // Fall back to type-based color
  return nodeColors[node.type] || DEFAULT_NODE_COLOR;
}
```

3. Update the Graph initialization to use the new function. Find the line:
```javascript
.nodeColor(node => nodeColors[node.type] || DEFAULT_NODE_COLOR)
```
And replace with:
```javascript
.nodeColor(node => getNodeColor(node))
```

4. Update the color legend to show both type AND status colors. Modify populateColorLegend():
```javascript
function populateColorLegend() {
  const legend = document.getElementById('color-legend');
  if (!legend) return;

  const formatTypeName = (type) => type.charAt(0).toUpperCase() + type.slice(1);

  // Node Types section
  const typeTitle = document.createElement('div');
  typeTitle.className = 'legend-title';
  typeTitle.textContent = 'Node Types';
  legend.appendChild(typeTitle);

  for (const [type, color] of Object.entries(nodeColors)) {
    const item = document.createElement('div');
    item.className = 'legend-item';

    const colorCircle = document.createElement('div');
    colorCircle.className = 'legend-color';
    colorCircle.style.backgroundColor = color;

    const label = document.createElement('span');
    label.className = 'legend-label';
    label.textContent = formatTypeName(type);

    item.appendChild(colorCircle);
    item.appendChild(label);
    legend.appendChild(item);
  }

  // Status Colors section
  const statusTitle = document.createElement('div');
  statusTitle.className = 'legend-title';
  statusTitle.style.marginTop = '12px';
  statusTitle.textContent = 'Progress Status';
  legend.appendChild(statusTitle);

  const statusLabels = {
    complete: 'Complete',
    'in-progress': 'In Progress',
    pending: 'Pending'
  };

  for (const [status, color] of Object.entries(statusColors)) {
    const item = document.createElement('div');
    item.className = 'legend-item';

    const colorCircle = document.createElement('div');
    colorCircle.className = 'legend-color';
    colorCircle.style.backgroundColor = color;

    const label = document.createElement('span');
    label.className = 'legend-label';
    label.textContent = statusLabels[status] || formatTypeName(status);

    item.appendChild(colorCircle);
    item.appendChild(label);
    legend.appendChild(item);
  }
}
```
  </action>
  <verify>
```bash
cd /home/rafreid/AFLUXSYS/products/GSDv
npm start
# Select the GSDv project folder
# Observe: Phase 1, 2, 3 nodes should be GREEN (complete)
# Phase 4, 5, 6 nodes should be GRAY (pending)
# Plans under completed phases should be GREEN
# Legend should show both type colors and status colors
```
  </verify>
  <done>
Nodes colored by status: completed phases/plans are green, pending are gray. Legend shows both type and status colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add status to node labels for clarity</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update the nodeLabel function to include status information for status-aware nodes.

Find the existing nodeLabel configuration:
```javascript
.nodeLabel(node => {
  let label = node.name;
  if (node.description) label += `\n${node.description}`;
  if (node.goal) label += `\n${node.goal}`;
  return label;
})
```

Replace with:
```javascript
.nodeLabel(node => {
  let label = node.name;

  // Add status badge for status-aware nodes
  if (node.status) {
    const statusBadge = {
      complete: '[COMPLETE]',
      'in-progress': '[IN PROGRESS]',
      pending: '[PENDING]'
    };
    label += ` ${statusBadge[node.status] || ''}`;
  }

  if (node.description) label += `\n${node.description}`;
  if (node.goal) label += `\nGoal: ${node.goal}`;
  return label;
})
```

This shows the status when hovering over nodes, making it even clearer what state each node is in.
  </action>
  <verify>
```bash
cd /home/rafreid/AFLUXSYS/products/GSDv
npm start
# Select project folder
# Hover over Phase 1 node - should show "[COMPLETE]" in label
# Hover over Phase 4 node - should show "[PENDING]" in label
```
  </verify>
  <done>
Node tooltips show status badges for phases and plans.
  </done>
</task>

</tasks>

<verification>
1. statusColors object defined with green/yellow/gray
2. getNodeColor function prioritizes status for phases/plans/requirements
3. Graph uses getNodeColor for nodeColor
4. Completed phases show green, pending show gray
5. Legend displays both node types and status colors
6. Node labels include status badges on hover
</verification>

<success_criteria>
- Completed nodes (phases, plans) appear green (#4CAF50)
- In-progress nodes appear yellow/amber (#FFC107)
- Pending nodes appear gray (#9E9E9E)
- File and directory nodes retain type-based colors (no status)
- Color legend shows both type colors and status colors
- Hovering shows status in tooltip
</success_criteria>

<output>
After completion, create `.planning/phases/04-state-visualization/04-02-SUMMARY.md`
</output>
