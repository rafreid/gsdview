---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/main/main.js
  - src/main/preload.js
  - src/renderer/index.html
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "User can click a button to open folder selection dialog"
    - "User can select a folder and see its path displayed"
    - "Selected folder path is available in renderer process"
  artifacts:
    - path: "src/main/main.js"
      provides: "IPC handler for folder dialog"
      contains: "dialog.showOpenDialog"
    - path: "src/main/preload.js"
      provides: "API for folder selection"
      contains: "selectFolder"
  key_links:
    - from: "src/renderer/renderer.js"
      to: "window.electronAPI.selectFolder"
      via: "preload bridge"
      pattern: "electronAPI.selectFolder"
    - from: "src/main/preload.js"
      to: "src/main/main.js"
      via: "IPC invoke"
      pattern: "ipcRenderer.invoke.*select-folder"
---

<objective>
Add project folder selection via native file dialog.

Purpose: This fulfills APP-01 (user can select project folder). The selected path will be used in later phases to parse .planning/ contents.
Output: A button that opens the native folder picker, with the selected path available to the renderer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IPC handler for folder selection in main process</name>
  <files>src/main/main.js</files>
  <action>
Update src/main/main.js to add folder selection IPC:

1. Import ipcMain and dialog from electron (add to existing imports)

2. Add IPC handler after app.whenReady():
```javascript
ipcMain.handle('select-folder', async () => {
  const result = await dialog.showOpenDialog(mainWindow, {
    properties: ['openDirectory'],
    title: 'Select GSD Project Folder'
  });

  if (result.canceled || result.filePaths.length === 0) {
    return null;
  }

  return result.filePaths[0];
});
```

3. Make sure mainWindow is accessible to the handler (either store it at module scope or pass it appropriately).

Note: Use 'openDirectory' property to restrict selection to folders only.
  </action>
  <verify>
main.js contains ipcMain.handle('select-folder')
main.js imports dialog from electron
  </verify>
  <done>Main process can handle folder selection requests</done>
</task>

<task type="auto">
  <name>Task 2: Expose folder selection API via preload</name>
  <files>src/main/preload.js</files>
  <action>
Update src/main/preload.js to expose selectFolder function:

```javascript
const { contextBridge, ipcRenderer } = require('electron');

contextBridge.exposeInMainWorld('electronAPI', {
  selectFolder: () => ipcRenderer.invoke('select-folder')
});
```

This creates window.electronAPI.selectFolder() in the renderer context, which:
- Returns a Promise
- Resolves to folder path string if selected
- Resolves to null if dialog was canceled
  </action>
  <verify>
preload.js exposes selectFolder function
Uses ipcRenderer.invoke pattern (not send/on)
  </verify>
  <done>Renderer can access folder selection via secure bridge</done>
</task>

<task type="auto">
  <name>Task 3: Add folder selection UI to renderer</name>
  <files>src/renderer/index.html, src/renderer/renderer.js</files>
  <action>
Update src/renderer/index.html:
- Add a toolbar/header area above the graph container
- Add "Select Project" button in the toolbar
- Add a span to display the selected folder path
- Style the toolbar: fixed position at top, semi-transparent dark background, z-index above graph

Example structure:
```html
<div id="toolbar">
  <button id="select-folder-btn">Select Project</button>
  <span id="selected-path">No project selected</span>
</div>
<div id="graph-container"></div>
```

CSS for toolbar:
- Position: fixed, top: 0, width: 100%
- Background: rgba(26, 26, 46, 0.9)
- Padding: 10px
- z-index: 100
- Adjust graph-container to have top padding/margin to not be hidden by toolbar

Update src/renderer/renderer.js:
- Add click handler for select-folder-btn
- Call window.electronAPI.selectFolder()
- Update selected-path span with result
- Store selected path for later use (in a variable or state)

```javascript
document.getElementById('select-folder-btn').addEventListener('click', async () => {
  const folderPath = await window.electronAPI.selectFolder();
  if (folderPath) {
    document.getElementById('selected-path').textContent = folderPath;
    // TODO: In later phases, parse .planning/ from this path
    console.log('Selected folder:', folderPath);
  }
});
```
  </action>
  <verify>
`npm start` shows toolbar with "Select Project" button
Clicking button opens native folder picker dialog
Selecting a folder displays its path in the toolbar
Canceling dialog leaves path unchanged
  </verify>
  <done>User can select project folder via UI (APP-01 complete)</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm start` launches app with toolbar visible
2. "Select Project" button is visible at top
3. Clicking button opens native macOS/Windows/Linux folder picker
4. Selecting a folder updates the displayed path
5. Canceling dialog has no effect
6. Graph remains functional below the toolbar
</verification>

<success_criteria>
- APP-01: User can select project folder via open dialog - VERIFIED
- Selected path is accessible in renderer for future parsing
- UI is non-intrusive (toolbar doesn't block graph)
- Ready for Phase 3 (GSD parsing) to use selected path
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
