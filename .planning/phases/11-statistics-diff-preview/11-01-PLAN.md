---
phase: 11-statistics-diff-preview
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/renderer.js
  - src/renderer/index.html
autonomous: true

must_haves:
  truths:
    - "User can see most frequently edited files ranked by change count"
    - "User can see change count per file in statistics display"
    - "User can see activity over time chart showing editing patterns"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Statistics calculation and panel rendering"
      contains: "calculateStatistics"
    - path: "src/renderer/index.html"
      provides: "Statistics panel UI structure and CSS"
      contains: "statistics-panel"
  key_links:
    - from: "src/renderer/renderer.js"
      to: "activityEntries"
      via: "calculateStatistics function processes activity data"
      pattern: "activityEntries\\.map|activityEntries\\.reduce"
---

<objective>
Create statistics panel showing most frequently edited files, change counts per file, and activity over time chart.

Purpose: Enable users to analyze their editing patterns and identify hotspots in the codebase during development sessions.
Output: Collapsible statistics panel with file rankings and time-based activity visualization.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Activity entries structure from Phase 8
# Entry: {id, path, relativePath, event, timestamp, sourceType, nodeId}
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add statistics panel UI structure and toggle</name>
  <files>src/renderer/index.html, src/renderer/renderer.js</files>
  <action>
Add statistics panel to index.html:

1. Add statistics toggle button to toolbar (after activity toggle):
   - ID: statistics-toggle
   - Text: Stats with icon (chart icon or similar)
   - Same styling pattern as activity-toggle

2. Add statistics panel structure below graph container:
   ```html
   <div id="statistics-panel" class="panel collapsed">
     <div class="panel-header">
       <span>Activity Statistics</span>
       <button id="stats-refresh" title="Refresh statistics">â†»</button>
     </div>
     <div id="stats-content">
       <div class="stats-section">
         <h4>Most Edited Files</h4>
         <div id="stats-file-ranking"></div>
       </div>
       <div class="stats-section">
         <h4>Activity Over Time</h4>
         <div id="stats-chart"></div>
       </div>
     </div>
   </div>
   ```

3. Add CSS styling for statistics panel:
   - Position: right side panel (similar to details panel)
   - Width: 320px
   - Collapsible with slide animation
   - File ranking entries with bar visualization for counts
   - Chart container with 200px height

4. In renderer.js, add toggle handler:
   - Toggle 'visible' class on panel
   - Update graph container sizing in handleResize()
  </action>
  <verify>
npm run build && npm start (in GSDv directory)
Click Stats toggle button, panel slides in from right
Click again, panel slides out
  </verify>
  <done>Statistics panel toggles visibility, styling matches app theme</done>
</task>

<task type="auto">
  <name>Task 2: Implement statistics calculation and file ranking display</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add statistics functions to renderer.js:

1. Create calculateStatistics() function:
   ```javascript
   function calculateStatistics() {
     // Count changes per file
     const fileCounts = {};
     activityEntries.forEach(entry => {
       const key = entry.relativePath;
       if (!fileCounts[key]) {
         fileCounts[key] = { path: key, count: 0, lastChange: 0, events: { created: 0, modified: 0, deleted: 0 } };
       }
       fileCounts[key].count++;
       fileCounts[key].events[entry.event]++;
       if (entry.timestamp > fileCounts[key].lastChange) {
         fileCounts[key].lastChange = entry.timestamp;
       }
     });

     // Sort by count descending
     const ranked = Object.values(fileCounts)
       .sort((a, b) => b.count - a.count)
       .slice(0, 10); // Top 10

     return { ranked, total: activityEntries.length };
   }
   ```

2. Create updateFileRanking() function:
   - Calculate statistics from activityEntries
   - Render ranked list with:
     - File path (truncated if long)
     - Change count badge
     - Horizontal bar showing relative count (max file = 100% width)
     - Color coding by dominant event type (created=green, modified=orange, deleted=red)
   - Handle empty state: "No activity recorded yet"

3. Create updateStatisticsPanel() that calls both ranking and chart updates

4. Hook into activity feed updates:
   - After addActivityEntry(), call updateStatisticsPanel() if panel visible
   - On panel open, call updateStatisticsPanel()

5. Add click handler to file ranking entries:
   - Find node by path and navigate to it (reuse handleActivityEntryClick pattern)
  </action>
  <verify>
npm run build && npm start
Open project, make file changes
Open Stats panel, verify files appear ranked by change count
Click a file entry, camera navigates to that node
  </verify>
  <done>File ranking shows top 10 most edited files with counts and click-to-navigate</done>
</task>

<task type="auto">
  <name>Task 3: Implement activity over time chart</name>
  <files>src/renderer/renderer.js, src/renderer/index.html</files>
  <action>
Add time-based activity visualization:

1. Create updateActivityChart() function:
   - Group activityEntries by time buckets (last hour in 5-min buckets, or last 24h in 1-hour buckets)
   - Calculate bucket size based on activity span
   - Build simple bar chart using div elements (no external charting library)

2. Chart HTML structure (generated dynamically):
   ```html
   <div class="activity-chart">
     <div class="chart-bars">
       <!-- For each time bucket -->
       <div class="chart-bar" style="height: {percent}%" title="{count} changes at {time}">
         <span class="bar-value">{count}</span>
       </div>
     </div>
     <div class="chart-axis">
       <span class="axis-start">{oldest time}</span>
       <span class="axis-end">Now</span>
     </div>
   </div>
   ```

3. Chart CSS styling:
   - Flexbox for bar alignment
   - Bars grow upward from bottom
   - Bar color gradient based on activity intensity
   - Time axis labels at start/end
   - Max height 150px for chart area
   - Bars animate on update (transition: height 0.3s)

4. Time bucket logic:
   - If activity spans < 1 hour: use 5-minute buckets (12 bars max)
   - If activity spans 1-24 hours: use 30-minute buckets
   - If activity spans > 24 hours: use 1-hour buckets (24 bars max)

5. Handle edge cases:
   - No activity: show "No activity data" message
   - Single activity: show one full-height bar
   - Very old activity: cap at 24 hours of display

6. Add refresh button handler to recalculate and redraw
  </action>
  <verify>
npm run build && npm start
Open project, make several file changes over time
Open Stats panel, verify chart shows activity distribution
Hover over bars to see tooltips with counts and times
  </verify>
  <done>Activity chart visualizes editing patterns over time with appropriate time buckets</done>
</task>

</tasks>

<verification>
After all tasks:
1. Statistics toggle button visible in toolbar
2. Panel slides in/out on toggle
3. File ranking shows top files with counts and visual bars
4. Clicking ranked file navigates to node in graph
5. Activity chart shows time-based distribution
6. Chart updates as new file changes occur
7. Refresh button recalculates statistics
8. Empty state handled gracefully
</verification>

<success_criteria>
- STS-01: Statistics panel shows most frequently edited files (ranked list with click-to-navigate)
- STS-02: Statistics panel shows change count per file (count badges and bar visualization)
- STS-03: Activity over time chart visualizes editing patterns (bar chart with time buckets)
</success_criteria>

<output>
After completion, create `.planning/phases/11-statistics-diff-preview/11-01-SUMMARY.md`
</output>
