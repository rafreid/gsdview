---
phase: 07-expanded-file-scope
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "src/ files display with cooler blue/cyan tones compared to .planning/ warmer tones"
    - "src/ files use different geometry shape than .planning/ files (icosahedron vs octahedron)"
    - "Tree panel shows both directories as siblings under project root"
    - "Tree icons are color-coded to match their graph node colors by sourceType"
    - "Both directories are expanded by default when project loads"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Visual differentiation and unified tree"
      contains: "sourceType"
  key_links:
    - from: "getNodeColor"
      to: "nodeThreeObject"
      via: "color passed to geometry material"
      pattern: "getNodeColor"
    - from: "buildTreeStructure"
      to: "renderTree"
      via: "tree data with sourceType"
      pattern: "sourceType"
---

<objective>
Add visual differentiation between .planning/ and src/ files in graph and tree

Purpose: Users can instantly distinguish which directory a file belongs to by color and shape
Output: src/ files have cooler tones and different shapes; tree shows unified structure with color-coded icons
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-expanded-file-scope/07-CONTEXT.md
@.planning/phases/07-expanded-file-scope/07-01-SUMMARY.md

# Key source file
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add src/ color palette with cooler tones</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add a new color constant for src/ files near the top of the file (around line 11):

```javascript
// Source-type base tints
const sourceTypeTints = {
  planning: { hue: 0, saturation: 0 },    // Warmer - keep existing colors
  src: { hue: 200, saturation: 0.15 }     // Cooler blue/cyan undertone
};

// src/ specific node colors (cooler tones)
const srcNodeColors = {
  file: '#7EC8E3',       // Cool blue (vs #DDA0DD plum for planning)
  directory: '#5B9BD5'   // Steel blue (vs #BB8FCE purple for planning)
};
```

Update `getNodeColor(node)` function to apply sourceType-based coloring:

```javascript
function getNodeColor(node) {
  // For phases, plans, tasks, requirements - use existing status colors
  const statusTypes = ['phase', 'plan', 'task', 'requirement'];
  if (statusTypes.includes(node.type) && node.status) {
    // ... existing status logic ...
  }

  // For files, use extension colors with sourceType tint
  if (node.type === 'file') {
    // Get base color from extension or default
    let baseColor = extensionColors[node.extension] || nodeColors.file;

    // Apply cooler tint for src/ files
    if (node.sourceType === 'src') {
      baseColor = applySourceTint(baseColor, 'src');
    }

    return baseColor;
  }

  // For directories, use sourceType-specific colors
  if (node.type === 'directory') {
    if (node.sourceType === 'src') {
      return srcNodeColors.directory;
    }
    return nodeColors.directory;
  }

  return nodeColors[node.type] || DEFAULT_NODE_COLOR;
}

// Helper to apply cooler tint to a color
function applySourceTint(hexColor, sourceType) {
  if (sourceType !== 'src') return hexColor;

  // Parse hex to RGB
  const hex = hexColor.replace('#', '');
  let r = parseInt(hex.substr(0, 2), 16);
  let g = parseInt(hex.substr(2, 2), 16);
  let b = parseInt(hex.substr(4, 2), 16);

  // Shift toward cooler tones (increase blue, decrease red slightly)
  r = Math.max(0, Math.round(r * 0.85));
  b = Math.min(255, Math.round(b * 1.15 + 20));

  // Convert back to hex
  return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
}
```
  </action>
  <verify>
Run app, open project with both directories.
src/ files should appear with noticeably bluer/cooler tones than .planning/ files.
.planning/ files should retain their existing warmer colors.
  </verify>
  <done>
src/ files display with cooler blue tones.
.planning/ files retain warmer existing colors.
Extension-based colors still work but with sourceType tint applied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add different geometry for src/ files</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update `nodeThreeObject` (around line 321) to use different shapes based on sourceType:

```javascript
.nodeThreeObject(node => {
  const size = getNodeSize(node, connectionCounts);
  const color = getNodeColor(node);

  // Directories: Use box/cube geometry (existing)
  if (node.type === 'directory') {
    // ... existing directory code ...
  }

  // Files: Different shapes based on sourceType
  if (node.type === 'file') {
    let geometry;

    if (node.sourceType === 'src') {
      // src/ files: Icosahedron (20-sided, more spherical)
      geometry = new THREE.IcosahedronGeometry(size * 0.7);
    } else {
      // .planning/ files: Octahedron (diamond shape) - existing
      geometry = new THREE.OctahedronGeometry(size * 0.8);
    }

    const material = new THREE.MeshBasicMaterial({
      color: color,
      transparent: true,
      opacity: 0.85
    });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.name = node.id;

    // Add wireframe for clarity
    const edges = new THREE.EdgesGeometry(geometry);
    const lineMaterial = new THREE.LineBasicMaterial({
      color: 0xffffff,
      opacity: 0.3,
      transparent: true
    });
    const wireframe = new THREE.LineSegments(edges, lineMaterial);
    mesh.add(wireframe);

    return mesh;
  }

  // ... rest of existing code ...
})
```

The visual distinction:
- .planning/ files: Octahedron (diamond, 8 faces) - angular, document-like
- src/ files: Icosahedron (20 faces) - rounder, code-like
  </action>
  <verify>
View graph with both directories loaded.
.planning/ files should appear as diamonds (octahedron).
src/ files should appear as more rounded shapes (icosahedron).
Shapes should be clearly distinguishable at normal zoom.
  </verify>
  <done>
src/ files use icosahedron geometry (rounded, 20 faces).
.planning/ files retain octahedron geometry (diamond, 8 faces).
Both shapes have wireframe outlines for clarity.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update tree panel for unified view with color-coded icons</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update tree-related functions to handle the unified directory structure:

1. Update `buildTreeStructure()` (around line 1120) - should already work since it uses the tree from directory data.

2. Update `getTreeIcon(node)` to show sourceType:
```javascript
function getTreeIcon(node) {
  if (node.type === 'directory') {
    // Root project folder
    if (node.sourceType === 'root') {
      return treeExpanded.has(node.id) ? 'ðŸ“‚' : 'ðŸ“';
    }
    // src/ directories get code folder icon
    if (node.sourceType === 'src') {
      return treeExpanded.has(node.id) ? 'ðŸ“‚' : 'ðŸ“';
    }
    // .planning/ directories
    return treeExpanded.has(node.id) ? 'ðŸ“‚' : 'ðŸ“';
  }
  // File icons remain extension-based
  const extIcons = { /* existing */ };
  return extIcons[node.extension] || 'ðŸ“„';
}
```

3. Update `getTreeColor(node)` to use sourceType:
```javascript
function getTreeColor(node) {
  if (node.type === 'directory') {
    if (node.sourceType === 'src') return '#5B9BD5';  // Cool steel blue
    if (node.sourceType === 'root') return '#FFFFFF'; // White for project root
    return '#BB8FCE';  // Purple for .planning/ (existing)
  }

  // Files: apply sourceType tint to extension colors
  let baseColor = extensionColors[node.extension] || '#DDA0DD';
  if (node.sourceType === 'src') {
    baseColor = applySourceTint(baseColor, 'src');
  }
  return baseColor;
}
```

4. Update `updateGraph()` to auto-expand both directories:
```javascript
// After building tree...
if (storedDirectoryData) {
  treeData = buildTreeStructure(storedDirectoryData);
  // Auto-expand root and both top-level directories
  if (treeData && treeData.length > 0) {
    treeExpanded.add(treeData[0].id);  // Project root
    // Expand children (should be .planning and src)
    if (treeData[0].children) {
      treeData[0].children.forEach(child => {
        treeExpanded.add(child.id);
      });
    }
  }
  updateTreePanel();
}
```
  </action>
  <verify>
1. Open tree panel - should show project name at top
2. Both .planning/ and src/ should appear as siblings
3. Both should be expanded by default
4. Directory colors should match graph colors (purple for .planning/, blue for src/)
5. File colors in tree should match their graph node colors
  </verify>
  <done>
Tree shows project root with .planning/ and src/ as siblings.
Both directories expanded by default on load.
Tree icon colors match graph node colors by sourceType.
  </done>
</task>

</tasks>

<verification>
1. Run `npm start` and open a project with both .planning/ and src/ directories
2. Graph verification:
   - .planning/ files are octahedrons with warmer colors (plum, purple tones)
   - src/ files are icosahedrons with cooler colors (blue/cyan tones)
   - Directories show appropriate sourceType colors
3. Tree panel verification:
   - Project root at top level
   - .planning/ and src/ as siblings under root
   - Both directories expanded by default
   - Tree colors match graph colors for each file/directory
4. Color legend should still be accurate (may need update if adding new legend items)
5. Open project with only .planning/ - verify no errors, tree shows only .planning/
</verification>

<success_criteria>
- src/ files visually distinct from .planning/ files by color (cooler) and shape (icosahedron)
- .planning/ files retain existing visual style (warmer, octahedron)
- Tree panel shows unified view with project root
- Both directories auto-expand on project load
- Tree icon colors match corresponding graph node colors
- Extension-based colors still work, with sourceType tint overlay
</success_criteria>

<output>
After completion, create `.planning/phases/07-expanded-file-scope/07-03-SUMMARY.md`
</output>
