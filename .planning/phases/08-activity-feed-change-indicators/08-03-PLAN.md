---
phase: 08-activity-feed-change-indicators
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - src/renderer/renderer.js
  - src/renderer/index.html
autonomous: false

must_haves:
  truths:
    - "Clicking activity entry navigates camera to that node in graph"
    - "Clicking activity entry opens details panel for that node"
    - "Activity feed auto-scrolls to show newest entries at top"
    - "Hovering activity entry highlights the corresponding node"
    - "Clicking deleted file entry shows appropriate message"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Activity entry interactions and auto-scroll"
      contains: "activity-entry.*click"
  key_links:
    - from: "activity-entry click"
      to: "selectTreeItem"
      via: "nodeId lookup and camera navigation"
      pattern: "selectTreeItem.*nodeId"
---

<objective>
Implement activity feed interactions: click-to-navigate, hover-to-highlight, and auto-scroll behavior.

Purpose: Connect the activity feed to the graph for seamless navigation to changed files.
Output: Fully interactive activity feed where entries navigate to nodes and auto-scroll shows latest changes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-activity-feed-change-indicators/08-CONTEXT.md
@.planning/phases/08-activity-feed-change-indicators/08-01-SUMMARY.md
@.planning/phases/08-activity-feed-change-indicators/08-02-SUMMARY.md
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement activity entry click-to-navigate</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add click handlers for activity entries to navigate to graph nodes:

1. Update updateActivityPanel to use event delegation for click handling:
   After rendering entries, add click listener on activity-content container.

2. Add click handler initialization (call once, not on every update):
   ```javascript
   // Initialize activity entry interactions (call once at bottom of file)
   function initActivityInteractions() {
     const content = document.getElementById('activity-content');
     if (!content) return;

     // Use event delegation for entries
     content.addEventListener('click', (e) => {
       const entry = e.target.closest('.activity-entry');
       if (!entry) return;

       const nodeId = entry.dataset.nodeId;
       const entryEvent = entry.classList.contains('deleted') ? 'deleted' :
                          entry.classList.contains('created') ? 'created' : 'modified';

       handleActivityEntryClick(nodeId, entryEvent, entry);
     });

     // Hover handler for highlighting
     content.addEventListener('mouseover', (e) => {
       const entry = e.target.closest('.activity-entry');
       if (!entry) return;

       const nodeId = entry.dataset.nodeId;
       if (nodeId) {
         highlightNodeInGraph(nodeId);
       }
     });

     content.addEventListener('mouseout', (e) => {
       const entry = e.target.closest('.activity-entry');
       if (!entry) return;

       clearNodeHighlight();
     });
   }

   // Call at end of file
   initActivityInteractions();
   ```

3. Create handleActivityEntryClick function:
   ```javascript
   function handleActivityEntryClick(nodeId, eventType, entryElement) {
     // Handle deleted files specially
     if (eventType === 'deleted') {
       // Show message that file no longer exists
       showDeletedFileMessage(entryElement);
       return;
     }

     // Navigate to node if it exists
     if (!nodeId) {
       console.log('[Activity] No nodeId for entry');
       return;
     }

     const graphNode = findNodeById(nodeId);
     if (!graphNode) {
       console.log('[Activity] Node not found in graph:', nodeId);
       showDeletedFileMessage(entryElement);
       return;
     }

     // Fly to node (reuse selectTreeItem logic for consistency)
     if (graphNode.x !== undefined) {
       const distance = 50 + getNodeSize(graphNode, connectionCounts) * 4;

       if (is3D) {
         const distRatio = 1 + distance / Math.hypot(graphNode.x || 0, graphNode.y || 0, graphNode.z || 0);
         Graph.cameraPosition(
           {
             x: (graphNode.x || 0) * distRatio,
             y: (graphNode.y || 0) * distRatio,
             z: (graphNode.z || 0) * distRatio
           },
           graphNode,
           1000
         );
       } else {
         Graph.cameraPosition(
           { x: graphNode.x || 0, y: graphNode.y || 0, z: distance + 100 },
           graphNode,
           1000
         );
       }

       // Flash the node
       flashNode(nodeId);
     }

     // Open details panel
     showDetailsPanel(graphNode);

     // Highlight in tree panel too
     highlightTreeItem(nodeId);
   }
   ```

4. Create showDeletedFileMessage function:
   ```javascript
   function showDeletedFileMessage(entryElement) {
     // Create tooltip-like message near the entry
     const existingMsg = document.querySelector('.activity-deleted-msg');
     if (existingMsg) existingMsg.remove();

     const msg = document.createElement('div');
     msg.className = 'activity-deleted-msg';
     msg.textContent = 'File no longer exists';
     msg.style.cssText = `
       position: fixed;
       background: rgba(231, 76, 60, 0.9);
       color: white;
       padding: 8px 12px;
       border-radius: 4px;
       font-size: 12px;
       z-index: 1000;
       pointer-events: none;
     `;

     // Position near the entry
     const rect = entryElement.getBoundingClientRect();
     msg.style.left = rect.left + 'px';
     msg.style.top = (rect.top - 35) + 'px';

     document.body.appendChild(msg);

     // Remove after 2 seconds
     setTimeout(() => msg.remove(), 2000);
   }
   ```
  </action>
  <verify>
Run `npm start`, open a project, trigger some file changes:
1. Click on "created" or "modified" entry -> camera flies to node
2. Details panel opens showing node info
3. Click on "deleted" entry -> shows "File no longer exists" message
4. Tree panel highlights the corresponding item
  </verify>
  <done>
Activity entry clicks navigate to nodes and open details panel. Deleted file entries show appropriate message instead of navigating to non-existent node.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement hover-to-highlight and auto-scroll</name>
  <files>src/renderer/renderer.js, src/renderer/index.html</files>
  <action>
Add hover highlighting and auto-scroll behavior:

1. Create node highlight functions for hover effect:
   ```javascript
   let highlightedNodeId = null;

   function highlightNodeInGraph(nodeId) {
     // Skip if already highlighted
     if (highlightedNodeId === nodeId) return;

     // Clear previous highlight
     clearNodeHighlight();

     const node = currentGraphData.nodes.find(n => n.id === nodeId);
     if (!node || !node.__threeObj) return;

     highlightedNodeId = nodeId;

     // Store original scale and apply highlight
     const threeObj = node.__threeObj;
     if (!threeObj.userData) threeObj.userData = {};
     threeObj.userData.originalScale = threeObj.scale.clone();

     // Scale up slightly for highlight effect
     threeObj.scale.multiplyScalar(1.3);

     // Add emissive glow if material supports it
     const materials = [];
     if (threeObj.material) materials.push(threeObj.material);
     if (threeObj.children) {
       threeObj.children.forEach(child => {
         if (child.material) materials.push(child.material);
       });
     }

     materials.forEach(m => {
       m.userData = m.userData || {};
       m.userData.originalOpacity = m.opacity;
       m.opacity = Math.min(1, m.opacity * 1.3);
     });
   }

   function clearNodeHighlight() {
     if (!highlightedNodeId) return;

     const node = currentGraphData.nodes.find(n => n.id === highlightedNodeId);
     if (node && node.__threeObj) {
       const threeObj = node.__threeObj;

       // Restore original scale
       if (threeObj.userData && threeObj.userData.originalScale) {
         threeObj.scale.copy(threeObj.userData.originalScale);
       }

       // Restore opacity
       const materials = [];
       if (threeObj.material) materials.push(threeObj.material);
       if (threeObj.children) {
         threeObj.children.forEach(child => {
           if (child.material) materials.push(child.material);
         });
       }

       materials.forEach(m => {
         if (m.userData && m.userData.originalOpacity !== undefined) {
           m.opacity = m.userData.originalOpacity;
         }
       });
     }

     highlightedNodeId = null;
   }
   ```

2. Update addActivityEntry to auto-scroll feed:
   At the end of addActivityEntry, after updateActivityPanel():
   ```javascript
   // Auto-scroll to top to show newest entry
   scrollActivityToTop();
   ```

3. Create scrollActivityToTop function:
   ```javascript
   function scrollActivityToTop() {
     const content = document.getElementById('activity-content');
     if (content) {
       content.scrollTop = 0;
     }
   }
   ```

4. Add CSS for hover state on entries (index.html):
   Add to the existing activity-entry styles:
   ```css
   .activity-entry:hover {
     background: rgba(78, 205, 196, 0.2);
     cursor: pointer;
   }

   .activity-entry.created:hover {
     background: rgba(46, 204, 113, 0.2);
   }

   .activity-entry.modified:hover {
     background: rgba(243, 156, 18, 0.2);
   }

   .activity-entry.deleted:hover {
     background: rgba(231, 76, 60, 0.2);
   }
   ```

5. Add tree-flash-created, tree-flash-modified, tree-flash-deleted keyframes (index.html):
   ```css
   @keyframes tree-flash-created {
     0% { background-color: rgba(46, 204, 113, 0.9); box-shadow: 0 0 15px rgba(46, 204, 113, 0.8); }
     15% { background-color: rgba(46, 204, 113, 0.3); }
     30% { background-color: rgba(46, 204, 113, 0.7); }
     45% { background-color: rgba(46, 204, 113, 0.2); }
     60% { background-color: rgba(46, 204, 113, 0.5); }
     100% { background-color: transparent; box-shadow: none; }
   }

   @keyframes tree-flash-modified {
     0% { background-color: rgba(243, 156, 18, 0.9); box-shadow: 0 0 15px rgba(243, 156, 18, 0.8); }
     15% { background-color: rgba(243, 156, 18, 0.3); }
     30% { background-color: rgba(243, 156, 18, 0.7); }
     45% { background-color: rgba(243, 156, 18, 0.2); }
     60% { background-color: rgba(243, 156, 18, 0.5); }
     100% { background-color: transparent; box-shadow: none; }
   }

   @keyframes tree-flash-deleted {
     0% { background-color: rgba(231, 76, 60, 0.9); box-shadow: 0 0 15px rgba(231, 76, 60, 0.8); }
     15% { background-color: rgba(231, 76, 60, 0.3); }
     30% { background-color: rgba(231, 76, 60, 0.7); }
     45% { background-color: rgba(231, 76, 60, 0.2); }
     60% { background-color: rgba(231, 76, 60, 0.5); }
     100% { background-color: transparent; box-shadow: none; }
   }

   .tree-flash-created { animation: tree-flash-created 2s ease-out; }
   .tree-flash-modified { animation: tree-flash-modified 2s ease-out; }
   .tree-flash-deleted { animation: tree-flash-deleted 2s ease-out; }
   ```
  </action>
  <verify>
Run `npm start`, open a project:
1. Hover over activity entry -> corresponding graph node scales up slightly
2. Move mouse away -> node returns to normal size
3. Trigger file change -> newest entry appears at top of feed
4. Feed scrolls to top automatically on new entries
5. Entry hover shows type-appropriate background color
  </verify>
  <done>
Hover-to-highlight working: graph nodes scale up when hovering corresponding activity entries. Auto-scroll keeps newest entries visible at top. Type-specific hover colors and tree flash animations added.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete activity feed with real-time file change tracking, type-specific animations, click-to-navigate, and hover-to-highlight.
  </what-built>
  <how-to-verify>
1. Run `npm start` and open a GSD project
2. Toggle the activity panel open using the bottom-left button
3. Create a new file in the project (src/ or .planning/):
   - Verify: Green "created" entry appears in feed
   - Verify: Graph node pulses green
   - Click the entry -> camera flies to node, details panel opens
4. Modify an existing file:
   - Verify: Orange "modified" entry appears in feed
   - Verify: Graph node pulses orange
5. Delete a file:
   - Verify: Red "deleted" entry appears in feed
   - Verify: Graph node pulses red and fades out
   - Click the deleted entry -> shows "File no longer exists" message
6. Close the activity panel:
   - Make a file change
   - Verify: Badge shows count, toggle button pulses briefly
   - Open panel -> badge clears
7. Hover over an activity entry:
   - Verify: Corresponding graph node highlights (scales up)
   - Move mouse away -> node returns to normal
8. Click clear button:
   - Verify: All entries removed, shows "No recent activity"
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Activity entry click navigates camera to graph node
- [ ] Activity entry click opens details panel
- [ ] Deleted file click shows "File no longer exists" message
- [ ] Hovering entry highlights corresponding node in graph
- [ ] Moving mouse away clears highlight
- [ ] New entries appear at top (auto-scroll)
- [ ] Type-specific hover colors working
- [ ] Tree flash animations use type-specific colors
- [ ] All requirements (FED-01 through FED-04, CHG-01 through CHG-03) satisfied
</verification>

<success_criteria>
Phase 8 complete with fully interactive activity feed:
1. FED-01: Live activity feed panel displays file changes
2. FED-02: Each entry shows timestamp, file path, and change type
3. FED-03: Feed auto-scrolls to show newest entries
4. FED-04: Clicking entry navigates to node in graph
5. CHG-01: Created files pulse green
6. CHG-02: Modified files pulse orange
7. CHG-03: Deleted files pulse red and fade out
</success_criteria>

<output>
After completion, create `.planning/phases/08-activity-feed-change-indicators/08-03-SUMMARY.md`
</output>
