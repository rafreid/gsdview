---
phase: 28-enhanced-flash-effects
plan: 01
type: execute
wave: 1
depends_on: ["27-01"]
files_modified: [src/renderer/renderer.js, src/renderer/index.css]
autonomous: true

must_haves:
  truths:
    - "Read operations from Claude display distinct blue flash animation"
    - "Flash glow radius is larger than v1.3 (visible from any zoom level)"
    - "Flash intensity is brighter by default with higher configurable max"
    - "Different operation types show distinct colors (blue=read, amber=write/edit, green=create, red=delete)"
    - "Claude operations trigger visual feedback distinct from file system events"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Claude operation event listener and enhanced flash parameters"
      contains: "onClaudeOperation"
    - path: "src/renderer/index.css"
      provides: "Tree panel flash animation for read operations"
      contains: "tree-flash-read"
  key_links:
    - from: "src/renderer/renderer.js"
      to: "window.electronAPI.onClaudeOperation"
      via: "event listener subscription"
      pattern: "onClaudeOperation.*=>.*flashNodeWithType"
    - from: "src/renderer/renderer.js"
      to: "changeTypeColors"
      via: "operation type to color mapping"
      pattern: "changeTypeColors.*read.*0x"
---

<objective>
Claude Code operations trigger distinct, highly visible flash animations with operation-specific colors

Purpose: Make read operations (not possible from file watchers alone) visible, and make all Claude operations more visible with enhanced glow effects
Output: Enhanced flash system responding to Claude IPC events with read/write/edit operation differentiation
</objective>

<execution_context>
@/home/rafreid/.claude/get-shit-done/workflows/execute-plan.md
@/home/rafreid/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-chokidar-extension-ipc/27-01-SUMMARY.md

# Key source files
@src/renderer/renderer.js
@src/renderer/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add read operation color and enhance flash parameters</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update the flash system to support read operations and make flashes more visible:

1. **Add 'read' color to changeTypeColors** (around line 158):
```javascript
const changeTypeColors = {
  read: 0x4488FF,     // Bright blue - read operations (Claude only)
  created: 0x00FF88,  // Bright neon green
  modified: 0xFFAA00, // Bright amber/orange
  deleted: 0xFF3333   // Bright red
};
```

2. **Add read pulse pattern in flashNodeWithType** (around line 1408):
After the existing changeType patterns (created, deleted, modified), add a read pattern:
```javascript
} else if (changeType === 'read') {
  // Read: 2 quick pulses (acknowledgment effect - lighter than modify)
  pulseCount = 2;
  pulsePattern = (progress, basePulse) => basePulse * 0.8; // Slightly dimmer
}
```
Insert this BEFORE the default `else` case for modified.

3. **Enhance glow radius and intensity in flashNodeWithType**:
- Increase emissiveIntensity multiplier from 2.0 to 3.5 (line ~1453):
  ```javascript
  const emissiveIntensity = intensity * flashIntensity * 3.5;
  ```
- Increase scale multiplier from 0.5 to 0.8 (line ~1466):
  ```javascript
  const scaleMultiplier = 1 + (intensity * 0.8 * flashIntensity);
  ```

4. **Update flashIntensity slider max** (around line 6590):
Change the intensity calculation to support higher max:
```javascript
// Allow up to 3x intensity (slider still 50-200 range, but multiply by 1.5)
flashIntensity = (value / 100) * 1.5; // Convert and boost: 50->0.75x, 100->1.5x, 200->3x
```
Also update the store persistence at ~6598 to use the same formula.
  </action>
  <verify>
Search renderer.js for:
- `read: 0x4488FF` in changeTypeColors
- `changeType === 'read'` in flashNodeWithType
- `intensity * flashIntensity * 3.5` for enhanced emissive
- `intensity * 0.8 * flashIntensity` for enhanced scale
  </verify>
  <done>
changeTypeColors has read color (0x4488FF), flashNodeWithType has read pulse pattern, emissive intensity multiplier is 3.5, scale multiplier is 0.8
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS animation for tree-flash-read</name>
  <files>src/renderer/index.css</files>
  <action>
Add CSS animation class for read operation flash in the tree panel.

Find the existing tree-flash animation classes (tree-flash-created, tree-flash-modified, tree-flash-deleted) and add a read variant:

```css
/* Read operation flash - blue glow for Claude read operations */
.tree-flash-read {
  animation: tree-flash-read var(--flash-duration, 2s) ease-out;
}

@keyframes tree-flash-read {
  0%, 100% {
    background-color: transparent;
    box-shadow: none;
    text-shadow: none;
  }
  15%, 30% {
    background-color: rgba(68, 136, 255, 0.4);
    box-shadow: inset 0 0 15px rgba(68, 136, 255, 0.6), 0 0 8px rgba(68, 136, 255, 0.4);
    text-shadow: 0 0 6px rgba(68, 136, 255, 0.8);
  }
  50% {
    background-color: rgba(68, 136, 255, 0.2);
    box-shadow: inset 0 0 10px rgba(68, 136, 255, 0.4), 0 0 5px rgba(68, 136, 255, 0.3);
    text-shadow: 0 0 4px rgba(68, 136, 255, 0.6);
  }
}
```

Place this near the other tree-flash animation classes (search for `.tree-flash-created`).
  </action>
  <verify>
Search index.css for:
- `.tree-flash-read` class
- `@keyframes tree-flash-read`
- `rgba(68, 136, 255` (the blue color)
  </verify>
  <done>
index.css contains tree-flash-read class with blue glow animation matching the 0x4488FF color from JS
  </done>
</task>

<task type="auto">
  <name>Task 3: Subscribe to Claude operations IPC and wire flash animations</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add the Claude operation event listener that connects IPC events to flash animations.

1. **Add listener near the existing onFilesChanged listener** (around line 5282, after the onFilesChanged block):

```javascript
// Listen for Claude Code operations (read/write/edit via hooks)
if (window.electronAPI && window.electronAPI.onClaudeOperation) {
  window.electronAPI.onClaudeOperation((event) => {
    console.log('[Claude Operation]', event.operation, event.file_path, 'nodeId:', event.nodeId);

    // Map Claude operations to change types for visual animation
    // - read: unique to Claude (file watchers can't detect reads)
    // - write: maps to 'modified' (file was written)
    // - edit: maps to 'modified' (file was edited)
    let changeType;
    if (event.operation === 'read') {
      changeType = 'read';
    } else if (event.operation === 'write' || event.operation === 'edit') {
      changeType = 'modified';
    } else {
      changeType = 'modified'; // Fallback for unknown operations
    }

    // Flash the node if we have a valid nodeId
    if (event.nodeId) {
      flashNodeWithType(event.nodeId, changeType);
      flashTreeItem(event.nodeId, changeType);

      // Follow camera to file if follow-active is enabled (but not for reads)
      if (followActiveEnabled && changeType !== 'read') {
        flyToNodeSmooth(event.nodeId);
      }
    }

    // Note: We don't add to activity feed here since these are Claude operations,
    // not file system events. The activity feed tracks file changes, not tool usage.
    // Could add a separate "Claude Activity" indicator in future if desired.
  });
}
```

2. **Ensure flashTreeItem handles 'read' changeType** (it already uses template literal `tree-flash-${changeType}` so it will work automatically with our CSS class).

The pattern follows the existing onFilesChanged listener exactly, just with different event structure and operation->changeType mapping.
  </action>
  <verify>
Run the application and verify in DevTools console:
1. `typeof window.electronAPI.onClaudeOperation === 'function'` returns true
2. When Claude reads a file, console shows "[Claude Operation] read" log
3. Search renderer.js for `onClaudeOperation.*=>` pattern
  </verify>
  <done>
onClaudeOperation listener subscribed, maps read->read and write/edit->modified, calls flashNodeWithType and flashTreeItem with appropriate change types
  </done>
</task>

</tasks>

<verification>
1. **Read operation flash (blue)**:
   - Have Claude read a file in the project
   - Graph node should flash with bright blue glow (0x4488FF)
   - Tree panel item should flash with blue animation
   - Console shows "[Claude Operation] read"

2. **Write operation flash (amber)**:
   - Have Claude write/edit a file
   - Graph node should flash with bright amber glow (existing 0xFFAA00)
   - Console shows "[Claude Operation] write" or "[Claude Operation] edit"

3. **Enhanced visibility**:
   - Flash glow should be noticeably larger/brighter than before
   - Scale pulse should be more pronounced (1.8x max vs old 1.5x)
   - Visible from overview zoom level

4. **No regression**:
   - File system changes still trigger flash via onFilesChanged
   - Existing created/modified/deleted colors still work
   - Flash duration/intensity sliders still functional
</verification>

<success_criteria>
- Read operations display distinct blue flash animation (CCI-04, FLX-04)
- Flash glow is larger (3.5x emissive vs 2.0x) and scale pulse is more pronounced (1.8x vs 1.5x) (FLX-05)
- Flash intensity slider supports up to 3x (vs old 2x) (FLX-06)
- Different operation types show distinct colors: blue=read, amber=write/edit, green=create, red=delete
- Claude operations logged to console for debugging
</success_criteria>

<output>
After completion, create `.planning/phases/28-enhanced-flash-effects/28-01-SUMMARY.md`
</output>
