---
phase: 31-view-switching
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/index.html
  - src/renderer/view-controller.js
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "User sees tab controls (Graph, Diagram) in toolbar"
    - "User can click tab to switch view"
    - "Graph view unmounts when switching to Diagram"
    - "Diagram container shows placeholder when active"
  artifacts:
    - path: "src/renderer/view-controller.js"
      provides: "View switching orchestration with lifecycle management"
      exports: ["switchToView", "getActiveView", "initViewSwitching"]
      min_lines: 60
    - path: "src/renderer/index.html"
      provides: "Tab controls and diagram container DOM"
      contains: "diagram-container"
  key_links:
    - from: "view-controller.js"
      to: "graph-renderer.js"
      via: "import { mount, unmount } from './graph-renderer.js'"
      pattern: "unmount\\(\\)"
    - from: "index.html"
      to: "view-controller.js"
      via: "onclick calls switchToView"
      pattern: "switchToView"
---

<objective>
Create view switching infrastructure with tab controls and lifecycle management.

Purpose: Establish the foundation for toggling between Graph and Diagram views with proper mounting/unmounting to prevent memory leaks and animation conflicts.

Output: Tab controls in toolbar, diagram-container DOM element, view-controller.js module that orchestrates view switching using graph-renderer lifecycle methods.
</objective>

<execution_context>
@/home/rafreid/.claude/get-shit-done/workflows/execute-plan.md
@/home/rafreid/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-architecture-foundation/30-02-SUMMARY.md
@src/renderer/state-manager.js
@src/renderer/graph-renderer.js (lines 7680-7791 for lifecycle methods)
@src/renderer/index.html (first 100 lines for structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add view tab controls and diagram container to HTML</name>
  <files>src/renderer/index.html</files>
  <action>
1. Add tab controls to the toolbar (#toolbar element) after the existing buttons:
   - Create a tab group container with two buttons: "Graph" (default active) and "Diagram"
   - Use existing toolbar button styling with active state indicator (border-bottom or background change)
   - Tab buttons use onclick to call switchToView('graph') or switchToView('diagram')

2. Add diagram-container div:
   - Position: same as #graph-container (full viewport below toolbar)
   - Initially hidden with display:none or a .hidden class
   - Contains a placeholder message: "Diagram view coming in Phase 32"

3. Add CSS styles:
   - .view-tab for tab buttons (match #toolbar button styling)
   - .view-tab.active for active state (teal border-bottom: 3px solid #4ECDC4)
   - #diagram-container positioning (mirrors #graph-container)
   - #diagram-container.hidden { display: none }
   - #graph-container.hidden { display: none }

CSS variables to use:
- Background: #1a1a2e
- Active color: #4ECDC4
- Text: #eee

Tab styling should match the existing toolbar aesthetic - simple, clean, teal accent.
  </action>
  <verify>
Visual inspection of index.html shows:
- Tab buttons exist in toolbar
- diagram-container div exists with placeholder
- CSS styles defined for tabs and containers
  </verify>
  <done>
- Two tab buttons visible in toolbar HTML
- diagram-container element present
- CSS hides inactive container
  </done>
</task>

<task type="auto">
  <name>Task 2: Create view-controller.js with lifecycle orchestration</name>
  <files>src/renderer/view-controller.js, src/renderer/renderer.js</files>
  <action>
1. Create src/renderer/view-controller.js:

```javascript
/**
 * View Controller
 *
 * Orchestrates switching between Graph and Diagram views.
 * Manages lifecycle (mount/unmount) to prevent memory leaks.
 */

import { mount as mountGraph, unmount as unmountGraph } from './graph-renderer.js';
import { state, setState } from './state-manager.js';

// Current active view: 'graph' or 'diagram'
let activeView = 'graph';

/**
 * Get the currently active view
 * @returns {'graph' | 'diagram'}
 */
export function getActiveView() {
  return activeView;
}

/**
 * Switch to the specified view
 * @param {'graph' | 'diagram'} viewName
 */
export function switchToView(viewName) {
  if (viewName === activeView) {
    console.log(`[ViewCtrl] Already on ${viewName} view`);
    return;
  }

  console.log(`[ViewCtrl] Switching from ${activeView} to ${viewName}`);

  const graphContainer = document.getElementById('graph-container');
  const diagramContainer = document.getElementById('diagram-container');
  const graphTab = document.getElementById('tab-graph');
  const diagramTab = document.getElementById('tab-diagram');

  if (viewName === 'diagram') {
    // Unmount graph to stop animations and free resources
    unmountGraph();

    // Hide graph, show diagram
    graphContainer.classList.add('hidden');
    diagramContainer.classList.remove('hidden');

    // Update tab states
    graphTab.classList.remove('active');
    diagramTab.classList.add('active');

    // TODO: mountDiagram() in Phase 32
    console.log('[ViewCtrl] Diagram view mounted (placeholder)');

  } else if (viewName === 'graph') {
    // TODO: unmountDiagram() in Phase 32

    // Hide diagram, show graph
    diagramContainer.classList.add('hidden');
    graphContainer.classList.remove('hidden');

    // Update tab states
    diagramTab.classList.remove('active');
    graphTab.classList.add('active');

    // Mount graph to resume animations
    mountGraph();

    console.log('[ViewCtrl] Graph view mounted');
  }

  activeView = viewName;
}

/**
 * Initialize view switching
 * Sets up initial state and tab click handlers
 */
export function initViewSwitching() {
  // Ensure graph is the default active view
  activeView = 'graph';

  // Make switchToView available globally for onclick handlers
  window.switchToView = switchToView;

  console.log('[ViewCtrl] View switching initialized, active view: graph');
}

// Auto-initialize when module loads
initViewSwitching();
```

2. Update src/renderer/renderer.js to import view-controller:

```javascript
// Entry point - imports and initializes graph renderer and view controller
import './graph-renderer.js';
import './view-controller.js';
```

Key behaviors:
- switchToView calls unmount on old view before hiding it
- switchToView calls mount on new view after showing it
- Early return if already on requested view
- Console logging for debugging lifecycle
- window.switchToView for HTML onclick handlers
  </action>
  <verify>
Run `npm run build` - should complete without errors.
Check bundle.js is generated with view-controller code included.
  </verify>
  <done>
- view-controller.js exists with switchToView, getActiveView, initViewSwitching exports
- renderer.js imports view-controller.js
- Build succeeds
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - build succeeds
2. Verify file existence:
   - `ls src/renderer/view-controller.js` exists
   - `grep "diagram-container" src/renderer/index.html` finds element
   - `grep "switchToView" src/renderer/view-controller.js` finds function
3. Check integration:
   - `grep "view-controller" src/renderer/renderer.js` confirms import
</verification>

<success_criteria>
1. Tab controls visible in HTML structure
2. diagram-container element exists with proper CSS
3. view-controller.js exports switchToView, getActiveView, initViewSwitching
4. renderer.js imports view-controller.js
5. Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/31-view-switching/31-01-SUMMARY.md`
</output>
