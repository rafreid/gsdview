---
phase: 13-modal-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/index.html
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "Double-clicking any file node opens the file inspector modal"
    - "Modal displays centered on screen with semi-transparent overlay backdrop"
    - "Modal has header with file name and close button"
    - "Modal has three collapsible sections: Diff, Structure, Context"
    - "Each section can be independently expanded or collapsed"
    - "Clicking backdrop or close button closes the modal"
    - "Pressing Esc key closes the modal"
  artifacts:
    - path: "src/renderer/index.html"
      provides: "Modal HTML structure and CSS styles"
      contains: "file-inspector-modal"
    - path: "src/renderer/renderer.js"
      provides: "openFileInspector function and double-click handler"
      contains: "openFileInspector"
  key_links:
    - from: "renderer.js onNodeClick"
      to: "openFileInspector function"
      via: "double-click detection with timing"
      pattern: "openFileInspector\\(node\\)"
    - from: "modal section headers"
      to: "section content toggle"
      via: "click event listener"
      pattern: "classList.toggle.*collapsed"
---

<objective>
Create a file inspector modal that opens on double-click of any file node, with collapsible sections for future content (diff, structure, context).

Purpose: Foundation for the v1.2 "File Deep Dive" feature - allows users to inspect files in detail without leaving the graph view. The modal provides organized sections that will be populated with rich content in subsequent phases.

Output: Working modal with three placeholder sections that can be expanded/collapsed independently.
</objective>

<execution_context>
@/home/rafreid/.claude/get-shit-done/workflows/execute-plan.md
@/home/rafreid/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/renderer/index.html
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add modal HTML and CSS to index.html</name>
  <files>src/renderer/index.html</files>
  <action>
Add the file inspector modal structure to index.html:

1. Add modal HTML just before the closing `</body>` tag (after `#details-panel`):
```html
<div id="file-inspector-overlay" class="hidden"></div>
<div id="file-inspector-modal" class="hidden">
  <div class="modal-header">
    <h2 id="inspector-title"></h2>
    <button id="inspector-close">&times;</button>
  </div>
  <div class="modal-body">
    <div class="collapsible-section" id="section-diff">
      <div class="section-header">
        <span class="section-toggle">&#9660;</span>
        <span class="section-title">Diff</span>
      </div>
      <div class="section-content">
        <p class="section-placeholder">Diff content will appear here (Phase 14)</p>
      </div>
    </div>
    <div class="collapsible-section" id="section-structure">
      <div class="section-header">
        <span class="section-toggle">&#9660;</span>
        <span class="section-title">Structure</span>
      </div>
      <div class="section-content">
        <p class="section-placeholder">File structure tree will appear here (Phase 15)</p>
      </div>
    </div>
    <div class="collapsible-section" id="section-context">
      <div class="section-header">
        <span class="section-toggle">&#9660;</span>
        <span class="section-title">Context</span>
      </div>
      <div class="section-content">
        <p class="section-placeholder">File context and metadata will appear here (Phase 16)</p>
      </div>
    </div>
  </div>
</div>
```

2. Add CSS styles within the `<style>` block (after statistics panel styles):

```css
/* File Inspector Modal */
#file-inspector-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 500;
  opacity: 0;
  transition: opacity 0.2s ease;
}

#file-inspector-overlay.visible {
  opacity: 1;
}

#file-inspector-overlay.hidden {
  display: none;
}

#file-inspector-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  max-width: 900px;
  max-height: 80vh;
  background: #1e1e2e;
  border: 1px solid #4ECDC4;
  border-radius: 8px;
  z-index: 501;
  display: flex;
  flex-direction: column;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

#file-inspector-modal.hidden {
  display: none;
}

#file-inspector-modal .modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid #333;
  background: rgba(26, 26, 46, 0.98);
  border-radius: 8px 8px 0 0;
}

#file-inspector-modal .modal-header h2 {
  margin: 0;
  font-size: 16px;
  color: #4ECDC4;
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

#inspector-close {
  background: none;
  border: none;
  color: #888;
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
  transition: color 0.2s;
}

#inspector-close:hover {
  color: #fff;
}

#file-inspector-modal .modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px;
}

/* Collapsible Sections */
.collapsible-section {
  margin-bottom: 12px;
  border: 1px solid #333;
  border-radius: 6px;
  overflow: hidden;
}

.collapsible-section:last-child {
  margin-bottom: 0;
}

.section-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: #2a2a4e;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s;
}

.section-header:hover {
  background: #353560;
}

.section-toggle {
  color: #4ECDC4;
  font-size: 10px;
  transition: transform 0.2s;
}

.collapsible-section.collapsed .section-toggle {
  transform: rotate(-90deg);
}

.section-title {
  font-size: 14px;
  font-weight: 500;
  color: #eee;
}

.section-content {
  padding: 16px;
  background: #1e1e2e;
  max-height: 400px;
  overflow-y: auto;
}

.collapsible-section.collapsed .section-content {
  display: none;
}

.section-placeholder {
  color: #666;
  font-style: italic;
  text-align: center;
  padding: 20px;
  margin: 0;
}

/* Modal body scrollbar */
#file-inspector-modal .modal-body::-webkit-scrollbar {
  width: 8px;
}

#file-inspector-modal .modal-body::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

#file-inspector-modal .modal-body::-webkit-scrollbar-thumb {
  background: #4ECDC4;
  border-radius: 4px;
}

#file-inspector-modal .modal-body::-webkit-scrollbar-thumb:hover {
  background: #45B7D1;
}

/* Section content scrollbar */
.section-content::-webkit-scrollbar {
  width: 6px;
}

.section-content::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

.section-content::-webkit-scrollbar-thumb {
  background: #4ECDC4;
  border-radius: 3px;
}
```
  </action>
  <verify>
Verify modal HTML is properly nested and CSS classes are defined:
- `#file-inspector-overlay` exists with `.hidden` class
- `#file-inspector-modal` exists with `.hidden` class
- Three `.collapsible-section` elements exist with ids: section-diff, section-structure, section-context
- CSS includes styles for all modal elements
  </verify>
  <done>
Modal HTML structure exists in index.html with overlay, header, close button, and three collapsible sections. All CSS styles for modal layout, positioning, and collapsible behavior are defined.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement double-click handler and modal logic in renderer.js</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add double-click detection and modal management to renderer.js:

1. Add state variables near the top of the file (after `let highlightedNodeId = null;`):
```javascript
// Double-click detection for file inspector
let lastClickTime = 0;
let lastClickNode = null;
const DOUBLE_CLICK_THRESHOLD = 300; // ms

// File inspector modal state
let inspectorNode = null; // Currently inspected file node
```

2. Modify the `.onNodeClick(node => {...})` handler to detect double-clicks:
   - At the START of the handler (before fly-to logic), add double-click detection:
```javascript
.onNodeClick(node => {
  // Double-click detection for file nodes
  const now = Date.now();
  if (node.type === 'file' && lastClickNode === node && (now - lastClickTime) < DOUBLE_CLICK_THRESHOLD) {
    // Double-click detected - open file inspector
    openFileInspector(node);
    lastClickTime = 0;
    lastClickNode = null;
    return; // Don't proceed with single-click behavior
  }
  lastClickTime = now;
  lastClickNode = node;

  // ... rest of existing single-click logic (fly-to, showDetailsPanel)
```

3. Add the `openFileInspector` function (place it near `showDetailsPanel`):
```javascript
// Open file inspector modal for a file node
function openFileInspector(node) {
  if (node.type !== 'file') return;

  inspectorNode = node;

  const overlay = document.getElementById('file-inspector-overlay');
  const modal = document.getElementById('file-inspector-modal');
  const title = document.getElementById('inspector-title');

  // Set title to file name
  title.textContent = node.name;

  // Show modal
  overlay.classList.remove('hidden');
  overlay.classList.add('visible');
  modal.classList.remove('hidden');

  // Reset sections to expanded state
  document.querySelectorAll('.collapsible-section').forEach(section => {
    section.classList.remove('collapsed');
  });

  console.log('[Inspector] Opened for:', node.name, node.path);
}

// Close file inspector modal
function closeFileInspector() {
  const overlay = document.getElementById('file-inspector-overlay');
  const modal = document.getElementById('file-inspector-modal');

  overlay.classList.remove('visible');
  setTimeout(() => {
    overlay.classList.add('hidden');
  }, 200); // Match CSS transition
  modal.classList.add('hidden');

  inspectorNode = null;
  console.log('[Inspector] Closed');
}
```

4. Add event listeners for modal interactions (place in initialization section, after existing event listeners):
```javascript
// File inspector modal event listeners
document.getElementById('inspector-close').addEventListener('click', closeFileInspector);
document.getElementById('file-inspector-overlay').addEventListener('click', closeFileInspector);

// Collapsible section toggle
document.querySelectorAll('.collapsible-section .section-header').forEach(header => {
  header.addEventListener('click', () => {
    const section = header.closest('.collapsible-section');
    section.classList.toggle('collapsed');
  });
});

// Close modal on Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    const modal = document.getElementById('file-inspector-modal');
    if (modal && !modal.classList.contains('hidden')) {
      closeFileInspector();
    }
  }
});
```

Note: The event listeners should be placed AFTER the DOM is ready. Add them in the same area where other DOM event listeners are set up (e.g., after the toolbar button listeners around line 2050+).
  </action>
  <verify>
Run `npm run build` to bundle the code and check for errors:
```bash
cd /home/rafreid/AFLUXSYS/products/GSDv && npm run build
```

Launch the app and test:
1. Double-click a file node - modal should open
2. Single-click a file node - should fly-to and show details panel (existing behavior)
3. Click close button (X) - modal should close
4. Click overlay backdrop - modal should close
5. Press Escape key - modal should close
6. Click each section header - section should collapse/expand
  </verify>
  <done>
Double-click on file nodes opens the inspector modal. Single-click retains existing fly-to + details panel behavior. Modal can be closed via: close button, backdrop click, or Escape key. Each section header toggles its collapsed state independently.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Build verification:
```bash
cd /home/rafreid/AFLUXSYS/products/GSDv && npm run build
```
Should complete without errors.

2. Functional verification:
- Launch app: `npm start`
- Load a project with files
- Single-click a file node: Should fly-to and open details panel (no change from before)
- Double-click a file node: Should open file inspector modal centered on screen
- Modal shows file name in header
- Modal has three sections: Diff, Structure, Context
- Click each section header: Section toggles collapsed/expanded
- Click X button: Modal closes
- Click dark overlay: Modal closes
- Press Escape: Modal closes

3. Visual verification:
- Modal appears centered with semi-transparent backdrop
- Modal has consistent styling with existing app (teal accents, dark theme)
- Section headers have hover state
- Toggle arrows rotate when collapsed
</verification>

<success_criteria>
- [x] MOD-01: Double-clicking a file node opens the file inspector modal
- [x] MOD-02: Modal has collapsible sections for diff, structure, and context
- Modal displays centered on screen with overlay backdrop
- Each section can be independently expanded or collapsed
- Modal closes via close button, backdrop click, or Escape key
</success_criteria>

<output>
After completion, create `.planning/phases/13-modal-foundation/13-01-SUMMARY.md`
</output>
