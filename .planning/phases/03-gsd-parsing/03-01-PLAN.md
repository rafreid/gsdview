---
phase: 03-gsd-parsing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/parsers/roadmap-parser.js
  - src/main/main.js
  - src/main/preload.js
autonomous: true

must_haves:
  truths:
    - "ROADMAP.md is parsed into structured phase/plan data"
    - "IPC channel exposes parsed roadmap data to renderer"
    - "Phase hierarchy (phases containing plans) is extracted"
  artifacts:
    - path: "src/main/parsers/roadmap-parser.js"
      provides: "parseRoadmap function"
      exports: ["parseRoadmap"]
    - path: "src/main/main.js"
      provides: "IPC handler for parse-roadmap"
      contains: "ipcMain.handle('parse-roadmap'"
    - path: "src/main/preload.js"
      provides: "parseRoadmap API exposed to renderer"
      contains: "parseRoadmap"
  key_links:
    - from: "src/main/main.js"
      to: "src/main/parsers/roadmap-parser.js"
      via: "require and call parseRoadmap"
      pattern: "require.*roadmap-parser"
---

<objective>
Parse ROADMAP.md to extract phase and plan hierarchy structure.

Purpose: The graph needs real data instead of placeholders. ROADMAP.md contains the authoritative list of phases and their associated plans - the primary hierarchy for the GSD Viewer.

Output: A parser module that reads ROADMAP.md and returns structured data with phases, plans, and their relationships. IPC channel to expose this to the renderer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/main/main.js
@src/main/preload.js
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create roadmap parser module</name>
  <files>src/main/parsers/roadmap-parser.js</files>
  <action>
Create a new directory `src/main/parsers/` and add `roadmap-parser.js`.

The parser should:
1. Accept a path to a .planning/ folder
2. Read `.planning/ROADMAP.md` using Node.js fs
3. Parse the markdown to extract:
   - Each phase (from `### Phase N:` headings or `**Phase N:**` patterns)
   - Phase goal, status (from `- [x]` or `- [ ]` checkboxes)
   - Plans listed under each phase (from `Plans:` section, `- [ ] XX-NN-PLAN.md` items)
4. Return structured data:
```javascript
{
  phases: [
    {
      id: 'phase-1',
      number: 1,
      name: 'Foundation',
      goal: 'User can open a project folder...',
      status: 'complete', // 'complete' | 'in-progress' | 'pending'
      plans: [
        { id: 'plan-01-01', name: '01-01-PLAN.md', description: 'brief objective' },
        ...
      ]
    },
    ...
  ]
}
```

Use simple regex-based parsing (no external markdown parser needed). The ROADMAP.md format is consistent:
- Phases marked with `- [x]` (complete) or `- [ ]` (incomplete) in Overview
- Phase details in `### Phase N:` sections
- Plans listed as `- [ ] XX-NN-PLAN.md - description`

Export the function: `module.exports = { parseRoadmap };`
  </action>
  <verify>
Create a simple test by running the parser against the project's own .planning/ROADMAP.md:
```bash
cd /home/rafreid/AFLUXSYS/products/GSDv
node -e "const {parseRoadmap} = require('./src/main/parsers/roadmap-parser'); console.log(JSON.stringify(parseRoadmap('.planning'), null, 2));"
```
Should output JSON with 6 phases, phase 1 and 2 marked complete.
  </verify>
  <done>
parseRoadmap('.planning') returns object with phases array containing all 6 phases from ROADMAP.md, each with id, number, name, goal, status, and plans array.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add IPC handler and preload API</name>
  <files>src/main/main.js, src/main/preload.js</files>
  <action>
In `src/main/main.js`:
1. Add require for the parser: `const { parseRoadmap } = require('./parsers/roadmap-parser');`
2. Add new IPC handler inside the `app.whenReady()` block:
```javascript
ipcMain.handle('parse-roadmap', async (event, planningPath) => {
  try {
    return parseRoadmap(planningPath);
  } catch (error) {
    console.error('Error parsing roadmap:', error);
    return { error: error.message, phases: [] };
  }
});
```

In `src/main/preload.js`:
1. Add the parseRoadmap function to the exposed API:
```javascript
contextBridge.exposeInMainWorld('electronAPI', {
  selectFolder: () => ipcRenderer.invoke('select-folder'),
  parseRoadmap: (planningPath) => ipcRenderer.invoke('parse-roadmap', planningPath)
});
```
  </action>
  <verify>
Launch the app and test via DevTools console:
```bash
npm start
# Then in DevTools console:
# const result = await window.electronAPI.parseRoadmap('/home/rafreid/AFLUXSYS/products/GSDv/.planning');
# console.log(result);
```
Should log parsed phases data.
  </verify>
  <done>
IPC channel 'parse-roadmap' registered, preload exposes `electronAPI.parseRoadmap()`, calling it from renderer returns parsed roadmap data.
  </done>
</task>

</tasks>

<verification>
1. Parser module exists at src/main/parsers/roadmap-parser.js
2. Running parser directly outputs valid JSON with phases
3. IPC handler registered in main.js
4. API exposed in preload.js
5. Can call from renderer DevTools and get real data
</verification>

<success_criteria>
- parseRoadmap function parses all phases from ROADMAP.md
- Each phase has: id, number, name, goal, status, plans array
- IPC channel works end-to-end (main -> preload -> renderer)
- Error handling returns empty phases array on failure
</success_criteria>

<output>
After completion, create `.planning/phases/03-gsd-parsing/03-01-SUMMARY.md`
</output>
