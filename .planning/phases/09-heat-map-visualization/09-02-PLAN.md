---
phase: 09-heat-map-visualization
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/renderer/renderer.js
  - src/renderer/index.html
autonomous: false

must_haves:
  truths:
    - "User can adjust heat decay rate to control cooling speed"
    - "Heat decay setting persists across app restarts"
  artifacts:
    - path: "src/renderer/index.html"
      provides: "Heat decay slider UI in toolbar"
      contains: "heat-decay-slider"
    - path: "src/renderer/renderer.js"
      provides: "Slider event handler and persistence"
      contains: "heat-decay-slider"
  key_links:
    - from: "heat-decay-slider"
      to: "heatDecayDuration"
      via: "input event handler"
      pattern: "addEventListener.*input.*heatDecayDuration"
    - from: "renderer.js"
      to: "electron-store"
      via: "window.electronAPI.store"
      pattern: "electronAPI.*store.*(get|set)"
---

<objective>
Add user-configurable heat decay rate with a slider control in the toolbar. Persist the setting using electron-store so it survives app restarts. Verify the complete heat map feature works as expected.

Purpose: HET-03 - User can configure heat decay rate (how fast files cool down)
Output: Working heat decay slider with persistence, full feature verification
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-heat-map-visualization/09-01-SUMMARY.md
@src/renderer/renderer.js
@src/renderer/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add heat decay slider UI to toolbar</name>
  <files>src/renderer/index.html</files>
  <action>
Add heat decay slider control to the toolbar in index.html:

1. Add slider styles in the style section (after the existing toolbar styles):
```css
/* Heat Decay Slider */
#heat-decay-container {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 15px;
  padding-left: 15px;
  border-left: 1px solid rgba(255,255,255,0.2);
}

#heat-decay-label {
  font-size: 12px;
  color: rgba(255,255,255,0.8);
  white-space: nowrap;
}

#heat-decay-slider {
  width: 100px;
  height: 4px;
  -webkit-appearance: none;
  background: rgba(255,255,255,0.2);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

#heat-decay-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: #FF6B6B;
  border-radius: 50%;
  cursor: pointer;
  transition: background 0.2s;
}

#heat-decay-slider::-webkit-slider-thumb:hover {
  background: #FF8C00;
}

#heat-decay-value {
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  min-width: 35px;
}
```

2. Add the slider HTML in the toolbar section (after the dimension-toggle button, before the closing toolbar div):
```html
<div id="heat-decay-container">
  <span id="heat-decay-label">Heat:</span>
  <input type="range" id="heat-decay-slider" min="30" max="600" value="300" title="Heat decay duration (seconds)">
  <span id="heat-decay-value">5m</span>
</div>
```

The slider range is 30-600 seconds (30s to 10 minutes), default 300 (5 minutes).
  </action>
  <verify>
Run `npm run build` - should complete without errors. Run `npm start` - slider should appear in toolbar with "Heat:" label and "5m" value display.
  </verify>
  <done>
Heat decay slider UI added to toolbar with label, range input (30s-10m), and current value display. Styled to match existing toolbar aesthetics.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement slider event handler and persistence</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add slider event handling and electron-store persistence:

1. Add function to format duration for display (near other utility functions):
```javascript
// Format duration in seconds to human-readable string
function formatHeatDuration(seconds) {
  if (seconds < 60) return `${seconds}s`;
  const minutes = Math.round(seconds / 60);
  return `${minutes}m`;
}
```

2. Add function to load saved heat decay setting (call this during initialization):
```javascript
// Load heat decay setting from store
async function loadHeatDecaySetting() {
  try {
    const saved = await window.electronAPI.store.get('heatDecaySeconds');
    if (saved && typeof saved === 'number') {
      heatDecayDuration = saved * 1000; // Convert to ms
      const slider = document.getElementById('heat-decay-slider');
      const valueDisplay = document.getElementById('heat-decay-value');
      if (slider) slider.value = saved;
      if (valueDisplay) valueDisplay.textContent = formatHeatDuration(saved);
    }
  } catch (err) {
    console.log('[Heat] Using default decay duration:', HEAT_MAX_DURATION / 1000, 'seconds');
  }
}
```

3. Add slider event listener (in the initialization section, after DOMContentLoaded or with other event listeners):
```javascript
// Heat decay slider handler
document.getElementById('heat-decay-slider')?.addEventListener('input', async (e) => {
  const seconds = parseInt(e.target.value, 10);
  heatDecayDuration = seconds * 1000; // Convert to ms

  // Update display
  const valueDisplay = document.getElementById('heat-decay-value');
  if (valueDisplay) valueDisplay.textContent = formatHeatDuration(seconds);

  // Save to store
  try {
    await window.electronAPI.store.set('heatDecaySeconds', seconds);
  } catch (err) {
    console.log('[Heat] Could not save setting:', err);
  }
});
```

4. Call loadHeatDecaySetting() during app initialization:
   - Find where other initialization happens (likely after DOMContentLoaded or at the end of the file)
   - Add: `loadHeatDecaySetting();`

Note: electron-store is already available via window.electronAPI.store (used for recent projects and window state). The preload script exposes get/set methods.
  </action>
  <verify>
Run `npm run build` and `npm start`. Drag the heat decay slider - value display should update (e.g., "1m", "3m", "10m"). Close and reopen the app - slider should restore to previously set value.
  </verify>
  <done>
Slider input updates heatDecayDuration in real-time. Value display shows human-readable format. Setting persists to electron-store and loads on app start.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete heat map visualization feature:
- Recently changed files glow hot (red/orange)
- Heat decays over time (red -> orange -> yellow -> normal)
- User-configurable decay rate via slider (30s - 10m)
- Setting persists across app restarts
  </what-built>
  <how-to-verify>
1. Run `npm start` to launch the app
2. Open a project with .planning/ and src/ directories
3. Edit a file in .planning/ (e.g., add a space and save)
4. Observe: Node should flash (orange for modify), then glow hot red
5. Wait 30-60 seconds: Color should transition toward orange/yellow
6. Drag the heat decay slider to "1m" (1 minute)
7. Edit another file: Should cool down faster (within 1 minute)
8. Drag slider to "30s" and edit a file: Should cool very quickly
9. Close the app and reopen: Slider should remember the "30s" setting
10. Edit a file: Should still use the 30s decay rate
  </how-to-verify>
  <resume-signal>Type "approved" if heat map works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. UI visible: Heat decay slider appears in toolbar with label and value
2. Slider works: Dragging slider updates value display and heat decay rate
3. Persistence: Closing and reopening app restores slider setting
4. Heat visual: Changed files glow hot and cool down at configured rate
5. Integration: Flash animations work correctly, heat continues after flash
</verification>

<success_criteria>
- HET-03: User can configure heat decay rate (how fast files cool down) - SATISFIED
- Slider range 30s-10m with reasonable default (5m)
- Setting persists in electron-store
- Visual feedback confirms setting changes
- All HET requirements (01, 02, 03) verified by human checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/09-heat-map-visualization/09-02-SUMMARY.md`
</output>
