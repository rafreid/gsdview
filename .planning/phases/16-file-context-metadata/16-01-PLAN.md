---
phase: 16-file-context-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/index.html
  - src/renderer/renderer.js
autonomous: true

must_haves:
  truths:
    - "User can see file path, size, modified date, and git status when viewing file inspector"
    - "User can click 'Open in Editor' to launch file in external editor"
    - "User can click 'Copy Path' to copy file path to clipboard"
    - "User can click 'Copy Content' to copy file content to clipboard"
  artifacts:
    - path: "src/renderer/index.html"
      provides: "CSS styles for metadata header and quick actions bar"
      min_lines: 50
      contains: ".metadata-header"
    - path: "src/renderer/renderer.js"
      provides: "populateInspectorContext() function with metadata and actions"
      exports: ["populateInspectorContext"]
      min_lines: 80
  key_links:
    - from: "populateInspectorContext()"
      to: "window.electronAPI.getFileStats"
      via: "fetch file metadata (size, modified)"
      pattern: "getFileStats.*fullPath"
    - from: "populateInspectorContext()"
      to: "gitStatusData"
      via: "lookup git status for current file"
      pattern: "gitStatusData\\.(modified|staged|untracked)"
    - from: "Quick actions buttons"
      to: "window.electronAPI.openFile"
      via: "launch external editor on click"
      pattern: "openFile.*fullPath"
---

<objective>
Add metadata header and quick actions bar to the file inspector Context section, showing file details and enabling common file operations.

Purpose: Users need quick access to file metadata (path, size, modified date, git status) and common actions (open in editor, copy path, copy content) without leaving the inspector modal.

Output: Fully functional Context section with metadata display and action buttons.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/15-structure-tree/15-02-SUMMARY.md
@src/renderer/index.html
@src/renderer/renderer.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add metadata header and quick actions CSS to Context section</name>
  <files>src/renderer/index.html</files>
  <action>
Add CSS styles for metadata header and quick actions bar inside the #section-context area.

Metadata header layout:
- Grid layout with label-value pairs (2 columns)
- Labels: color #888, 11px, uppercase
- Values: color #ccc, 13px
- Git status badge with color-coded background (staged=green, modified=orange, untracked=purple, clean=gray)
- 12px padding, 1px border-bottom separator

Quick actions bar layout:
- Horizontal flexbox with 3 buttons
- Each button: 32px height, 10px padding, 4px border-radius
- Primary action color (#4ECDC4) for Open in Editor
- Secondary color (#888) for Copy Path/Content
- Hover state: lighten color
- Icon + text layout with 6px gap
- 8px gap between buttons

Match existing modal section styles (collapsible-section, section-content patterns from Structure and Diff sections).
  </action>
  <verify>
Grep for ".metadata-header" and ".quick-actions" styles in index.html
Count: should find 2 new CSS class definitions
  </verify>
  <done>
CSS styles added to index.html for metadata header grid and quick actions button bar
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement populateInspectorContext() with metadata and actions</name>
  <files>src/renderer/renderer.js</files>
  <action>
Create populateInspectorContext() function that populates the Context section with file metadata and quick actions.

Metadata display (call window.electronAPI.getFileStats):
- File Path: full path (inspectorNode.path with sourceType prefix)
- File Size: format bytes as KB/MB (use formatFileSize helper)
- Last Modified: format timestamp as readable date/time (use new Date().toLocaleString())
- Git Status: lookup in gitStatusData (staged/modified/untracked/clean)

Quick actions implementation:
1. Open in Editor button:
   - Click handler calls window.electronAPI.openFile(fullPath)
   - Icon: â–¶ or similar

2. Copy Path button:
   - Click handler uses navigator.clipboard.writeText(fullPath)
   - Show toast notification "Path copied"
   - Icon: ðŸ“‹ or similar

3. Copy Content button:
   - Click handler reads file via window.electronAPI.readFileContent
   - Uses navigator.clipboard.writeText(content)
   - Show toast notification "Content copied"
   - Icon: ðŸ“„ or similar

Error handling:
- If getFileStats fails, show "Unable to load file metadata"
- If clipboard fails, show error toast

Call populateInspectorContext() from openFileInspector() after populateInspectorDiff and populateInspectorStructure.

Helper function formatFileSize(bytes):
- < 1024: return bytes + " B"
- < 1024*1024: return (bytes/1024).toFixed(1) + " KB"
- else: return (bytes/(1024*1024)).toFixed(1) + " MB"
  </action>
  <verify>
Grep for "function populateInspectorContext" in renderer.js
Grep for "formatFileSize" helper function
Test: Open file inspector, check Context section populated with metadata and 3 action buttons
  </verify>
  <done>
populateInspectorContext() implemented with metadata fetching, git status lookup, and 3 working action buttons
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire Context section population to modal open event</name>
  <files>src/renderer/renderer.js</files>
  <action>
Update openFileInspector() to call populateInspectorContext() after the modal opens.

Insert after populateInspectorStructure() call:
```javascript
// Populate context section
populateInspectorContext();
```

Also replace the placeholder text in #section-context .section-content with an empty div ready for population:
```javascript
const contextSection = document.querySelector('#section-context .section-content');
if (contextSection) {
  contextSection.innerHTML = '<div class="context-loading">Loading file metadata...</div>';
}
```

This ensures the Context section is populated every time the modal opens for a file.
  </action>
  <verify>
Grep for "populateInspectorContext()" call in openFileInspector function
Double-click a file node, verify Context section shows metadata and action buttons
Click "Open in Editor" button, verify file opens externally
Click "Copy Path" button, verify path copied to clipboard
  </verify>
  <done>
Context section automatically populates with metadata and actions when file inspector modal opens
  </done>
</task>

</tasks>

<verification>
Manual testing:
1. Launch app, load project with git repository
2. Double-click any file node in the graph
3. Expand Context section in modal
4. Verify metadata header shows: path, size, modified date, git status badge
5. Click "Open in Editor" - file opens in external editor
6. Click "Copy Path" - verify path in clipboard
7. Click "Copy Content" - verify file content in clipboard
8. Test with files in different git states (modified, staged, clean)

Requirements satisfied:
- CTX-01: Metadata header with path, size, modified date, git status âœ“
- CTX-02: "Open in Editor" button âœ“
- CTX-03: "Copy Path" button âœ“
- CTX-04: "Copy Content" button âœ“
</verification>

<success_criteria>
- Metadata header displays file path, size, last modified timestamp, and git status with color-coded badge
- "Open in Editor" button successfully launches file in external editor
- "Copy Path" button copies full file path to clipboard
- "Copy Content" button copies entire file content to clipboard
- All actions work for both .planning/ and src/ files
- Git status badge correctly reflects staged (green), modified (orange), untracked (purple), or clean (gray) states
</success_criteria>

<output>
After completion, create `.planning/phases/16-file-context-metadata/16-01-SUMMARY.md`
</output>
