---
phase: 19-enhanced-flash-effects
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - src/renderer/renderer.js
  - src/renderer/index.html
autonomous: true

must_haves:
  truths:
    - "User can adjust flash duration via settings slider"
    - "User can adjust flash intensity via settings slider"
    - "Settings persist across app restarts"
  artifacts:
    - path: "src/renderer/renderer.js"
      provides: "Flash settings load/save functions"
      contains: "flashDuration"
    - path: "src/renderer/index.html"
      provides: "Flash settings UI controls" 
      contains: "flash-duration-slider"
  key_links:
    - from: "flash-duration-slider"
      to: "flashDuration variable"
      via: "input event listener"
      pattern: "flashDuration.*slider"
    - from: "window.electronAPI.store"
      to: "flash settings"
      via: "get/set calls"
      pattern: "store\\.(get|set).*flash"
---

<objective>
Add settings panel controls for flash duration and intensity, with persistence via electron-store.

Purpose: Different users have different preferences for animation visibility. This plan allows users to customize flash behavior.
Output: Two new sliders in the settings area that control flash duration (0.5s to 5s) and intensity (0.5x to 2x).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-enhanced-flash-effects/19-01-SUMMARY.md
@src/renderer/renderer.js (heat decay slider pattern around line 5051)
@src/renderer/index.html (heat-decay-container around line 2029)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add flash settings UI controls</name>
  <files>src/renderer/index.html</files>
  <action>
Add two new settings sliders next to the existing heat decay slider (after line 2033):

1. Flash Duration slider:
   - Container div with id="flash-duration-container"
   - Label: "Flash:"
   - Slider: id="flash-duration-slider", min="500", max="5000", value="2000", step="100"
   - Value display: id="flash-duration-value", initial text "2s"
   - Title: "Flash animation duration (milliseconds)"

2. Flash Intensity slider:
   - Container div with id="flash-intensity-container"
   - Label: "Glow:"
   - Slider: id="flash-intensity-slider", min="50", max="200", value="100", step="10"
   - Value display: id="flash-intensity-value", initial text "1x"
   - Title: "Flash glow intensity multiplier"

3. Add CSS styles matching the heat-decay-slider pattern (around line 1001):
```css
#flash-duration-container,
#flash-intensity-container {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 12px;
  border-left: 1px solid rgba(255,255,255,0.1);
}

#flash-duration-container span,
#flash-intensity-container span {
  font-size: 12px;
  color: rgba(255,255,255,0.8);
  white-space: nowrap;
}

#flash-duration-slider,
#flash-intensity-slider {
  width: 80px;
  height: 4px;
  -webkit-appearance: none;
  background: rgba(255,255,255,0.2);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

#flash-duration-slider::-webkit-slider-thumb,
#flash-intensity-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: #4ECDC4;
  border-radius: 50%;
  cursor: pointer;
  transition: background 0.2s;
}

#flash-duration-slider::-webkit-slider-thumb:hover,
#flash-intensity-slider::-webkit-slider-thumb:hover {
  background: #6EE7E0;
}

#flash-duration-value,
#flash-intensity-value {
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  min-width: 30px;
}
```

Use teal color (#4ECDC4) for the slider thumbs to differentiate from heat (red/orange).
  </action>
  <verify>
1. App launches without errors
2. Two new sliders visible in header next to Heat slider
3. Flash slider shows "Flash:" label with "2s" default value
4. Glow slider shows "Glow:" label with "1x" default value
5. Sliders are draggable and update their value displays
  </verify>
  <done>
Settings panel has Flash Duration and Flash Intensity sliders with proper styling that matches the existing heat decay slider.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire up flash settings with persistence</name>
  <files>src/renderer/renderer.js</files>
  <action>
Add event listeners and persistence for the flash settings (near line 5051 with heat decay):

1. Add load function for flash settings (near loadHeatDecaySetting):
```javascript
// Load flash settings from store
async function loadFlashSettings() {
  try {
    const savedDuration = await window.electronAPI.store.get('flashDurationMs');
    const savedIntensity = await window.electronAPI.store.get('flashIntensityPercent');

    if (savedDuration && typeof savedDuration === 'number') {
      flashDuration = savedDuration;
      const slider = document.getElementById('flash-duration-slider');
      const valueDisplay = document.getElementById('flash-duration-value');
      if (slider) slider.value = savedDuration;
      if (valueDisplay) valueDisplay.textContent = formatFlashDuration(savedDuration);
    }

    if (savedIntensity && typeof savedIntensity === 'number') {
      flashIntensity = savedIntensity / 100;
      const slider = document.getElementById('flash-intensity-slider');
      const valueDisplay = document.getElementById('flash-intensity-value');
      if (slider) slider.value = savedIntensity;
      if (valueDisplay) valueDisplay.textContent = formatFlashIntensity(savedIntensity);
    }
  } catch (err) {
    console.log('[Flash] Could not load settings:', err);
  }
}

// Format functions
function formatFlashDuration(ms) {
  if (ms >= 1000) {
    return (ms / 1000).toFixed(1).replace('.0', '') + 's';
  }
  return ms + 'ms';
}

function formatFlashIntensity(percent) {
  return (percent / 100).toFixed(1).replace('.0', '') + 'x';
}
```

2. Add event listeners (near line 5066 after heat decay listener):
```javascript
// Flash duration slider
document.getElementById('flash-duration-slider')?.addEventListener('input', async (e) => {
  const ms = parseInt(e.target.value, 10);
  flashDuration = ms;

  const valueDisplay = document.getElementById('flash-duration-value');
  if (valueDisplay) valueDisplay.textContent = formatFlashDuration(ms);

  try {
    await window.electronAPI.store.set('flashDurationMs', ms);
  } catch (err) {
    console.log('[Flash] Could not save duration:', err);
  }
});

// Flash intensity slider
document.getElementById('flash-intensity-slider')?.addEventListener('input', async (e) => {
  const percent = parseInt(e.target.value, 10);
  flashIntensity = percent / 100;

  const valueDisplay = document.getElementById('flash-intensity-value');
  if (valueDisplay) valueDisplay.textContent = formatFlashIntensity(percent);

  try {
    await window.electronAPI.store.set('flashIntensityPercent', percent);
  } catch (err) {
    console.log('[Flash] Could not save intensity:', err);
  }
});

// Load flash settings on startup
loadFlashSettings();
```

3. Update flashNodeWithType to use the configurable duration:
   - Replace hardcoded `const duration = 2000;` with `const duration = flashDuration;`
   - The intensity multiplier (flashIntensity) should already be used from Plan 01

4. Update tree flash CSS animation duration dynamically:
   - Add CSS custom property: document.documentElement.style.setProperty('--flash-duration', flashDuration + 'ms');
   - Update index.html tree flash animations to use: animation: tree-flash-created var(--flash-duration, 2s) ease-out;
  </action>
  <verify>
1. Change flash duration slider - flash animations use new duration
2. Change flash intensity slider - flash glow brightness changes
3. Close and reopen app - settings are restored to saved values
4. Test with short duration (500ms) - quick flashes
5. Test with long duration (5000ms) - slow, dramatic flashes
6. Test with low intensity (0.5x) - subtle glow
7. Test with high intensity (2x) - bright, intense glow
  </verify>
  <done>
Flash duration and intensity settings are functional, persist across app restarts, and affect both 3D graph and tree panel animations.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. App launches: `npm start`
3. UI check: Flash Duration and Glow sliders visible in header
4. Duration test: Set to 1s, trigger file change - flash completes in ~1 second
5. Duration test: Set to 4s, trigger file change - flash takes ~4 seconds
6. Intensity test: Set to 0.5x, trigger change - subtle glow effect
7. Intensity test: Set to 2x, trigger change - very bright glow effect
8. Persistence test: Set custom values, close app, reopen - values restored
9. Tree sync test: Tree flash duration matches graph flash duration
</verification>

<success_criteria>
1. Flash duration slider adjusts animation length from 0.5s to 5s
2. Flash intensity slider adjusts glow brightness from 0.5x to 2x
3. Slider value displays update in real-time as user drags
4. Settings persist via electron-store across app restarts
5. Both 3D graph and tree panel respect the configured settings
</success_criteria>

<output>
After completion, create `.planning/phases/19-enhanced-flash-effects/19-02-SUMMARY.md`
</output>
